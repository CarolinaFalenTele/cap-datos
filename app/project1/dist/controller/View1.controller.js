sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/format/DateFormat","sap/viz/ui5/controls/VizFrame","sap/ui/model/odata/v4/ODataModel","sap/m/MessageToast","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/json/JSONModel"],function(e,t,o,a,s,r,n,i,l,c){"use strict";return e.extend("project1.controller.View1",{recursoID:null,onInit:function(){var e=new sap.ui.model.json.JSONModel({milestones:[{fase:"Kick off",fechaInicio:null,fechaFin:null},{fase:"Dise√±o",fechaInicio:null,fechaFin:null},{fase:"Construcci√≥n",fechaInicio:null,fechaFin:null},{fase:"Pruebas TQ",fechaInicio:null,fechaFin:null},{fase:"Go live",fechaInicio:null,fechaFin:null},{fase:"Paso AM",fechaInicio:null,fechaFin:null},{fase:"Server post/prod",fechaInicio:null,fechaFin:null}],chartData:[]});this.getView().setModel(e,"planning");var t=this.byId("idVizFrame");t.setVizProperties({title:{text:"Planificacion"}});this._tableValues={tablaConsuExter:{},table_dimicFecha:{},tablaRecExterno:{},idOtroserConsu:{},idGastoViajeConsu:{},idServiExterno:{},idGastoRecuExter:{},table0_1724413700665:{},table0_1727955577124:{},table0_1727879576857:{},table0_1727879940116:{}};this._editedRows=this._editedRows||{};this._rowYearlySums=this._rowYearlySums||{};this.currentRow=0;this.currentTable=0;var o=new sap.ui.model.json.JSONModel({fechas:[{fase:"Fechas Importantes",fechaInicioConstruccion:"2024-09-01",fechaFinPruebasTQ:"2024-09-30"}]});this.getView().setModel(o,"fechasModel");var a=this.byId("idVizFrame2");a.setVizProperties({title:{text:"Plan"}});this.updateVizFrame1();this.updateVizFrame3();var s=sap.ui.core.UIComponent.getRouterFor(this);s.getRoute("view").attachPatternMatched(this._onObjectMatched,this);this.updateVizFrame2();this._yearlySums={2024:0,2025:0,2026:0,2027:0,2028:0,2029:0};this.token();this.getUserInfo()},highlightControls:function(){console.log("Se cambiaron las pesta√±as debido a campos vac√≠os.");const e=[this.byId("input0"),this.byId("input1"),this.byId("idDescripcion"),this.byId("int_clienteFun"),this.byId("id_Cfactur"),this.byId("id_Cfactur"),this.byId("idObje"),this.byId("idAsunyRestri"),this.byId("box_multiJuridica"),this.byId("box_pluriAnual"),this.byId("slct_area"),this.byId("slct_Jefe"),this.byId("slct_verti"),this.byId("slct_inic"),this.byId("idNatu"),this.byId("selct_Amrecp"),this.byId("selc_ejcu"),this.byId("selc_Segui"),this.byId("slct_client"),this.byId("date_inico"),this.byId("date_fin"),this.byId("input0"),this.byId("input1"),this.byId("box_pluriAnual"),this.byId("id_Cfactur"),this.byId("box_multiJuridica")];e.forEach(e=>{if(e&&e.setValueState){e.setValueState("Success")}});setTimeout(()=>{e.forEach(e=>{if(e&&e.setValueState){e.setValueState("None")}})},2e3)},getUserInfo:function(){fetch("/odata/v4/datos-cdo/getUserInfo").then(e=>{if(!e.ok){throw new Error("No se pudo obtener la informaci√≥n del usuario.")}return e.json()}).then(e=>{const t=e.value;if(t){const e=this.byId("dddtg");e?.setText(t.email);e?.setTooltip(t.email);this.byId("23d3")?.setText(t.fullName);console.log("üìå Datos seteados en la vista:",t)}else{console.error("No se encontr√≥ la informaci√≥n del usuario.")}}).catch(e=>{console.error("‚ùå Error obteniendo datos del usuario:",e)})},onEmailPress:function(e){const t=e.getSource().getText();window.location.href="mailto:"+t},_onObjectMatched:async function(e){const t=this._sCsrfToken;var o=this.getView().getModel("mainService");if(o){o.setData({});o.refresh(true)}var a=e.getParameter("arguments").sProjectID;this._sProjectID=a;var s=`/odata/v4/datos-cdo/DatosProyect(${a})`;try{const e=await fetch(s,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","x-csrf-token":t}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const o=await e.json();if(o){this.byId("input0").setValue(o.codigoProyect||"");this.byId("input1").setValue(o.nameProyect||"");this.byId("23d3").setText(o.Empleado||"");this.byId("dddtg").setText(o.Email||"");this.byId("int_clienteFun").setValue(o.funcionalString||"");this.byId("id_Cfactur").setValue(o.clienteFacturacion||"");this.byId("idObje").setValue(o.objetivoAlcance||"");this.byId("idDescripcion").setValue(o.descripcion||"");this.byId("text67_1728582763477").setText(o.Total||"");this.byId("idAsunyRestri").setValue(o.AsuncionesyRestricciones||"");this.byId("box_multiJuridica").setSelected(!!o.multijuridica);this.byId("box_pluriAnual").setSelected(!!o.pluriAnual);this.byId("slct_area").setSelectedKey(o.Area_ID||"");this.byId("slct_Jefe").setSelectedKey(o.jefeProyectID_ID||"");this.byId("slct_verti").setSelectedKey(o.Vertical_ID||"");this.byId("slct_inic").setSelectedKey(o.Iniciativa_ID||"");if(o.Iniciativa_ID==="423e4567-e89b-12d3-a456-426614174003"){this.byId("table0").setVisible(true)}else{this.byId("table0").setVisible(false)}this.byId("idNatu").setSelectedKey(o.Naturaleza_ID||"");this.byId("selct_Amrecp").setSelectedKey(o.AmReceptor_ID||"");this.byId("selc_ejcu").setSelectedKey(o.EjecucionVia_ID||"");this.byId("selc_Segui").setSelectedKey(o.Seguimiento_ID||"");this.byId("slct_client").setSelectedKey(o.clienteFuncional_ID||"");this.byId("date_inico").setDateValue(o.Fechainicio?new Date(o.Fechainicio):null);this.byId("date_fin").setDateValue(o.FechaFin?new Date(o.FechaFin):null);this.byId("input0").setValue(o.codigoProyect);this.byId("input1").setValue(o.nameProyect);this.byId("box_pluriAnual").setSelected(o.pluriAnual);this.byId("id_Cfactur").setValue(o.clienteFacturacion);this.byId("box_multiJuridica").setSelected(o.multijuridica);await Promise.all([this.fetchMilestones(a),this.leerProveedor(a),this.leerFacturacion(a),this.leerClientFactura(a),this.leerRecursos(a),this.leerConsumoExterno(a),this.leerGastoViajeConsu(a),this.leerRecursoExterno(a),this.leerOtrosServiExter(a),this.leerOtrosConcepto(a),this.leerSerivioInterno(a),this.leerGastoviajeInterno(a),this.leerConsuOtroServi(a),this.leerGastoViaExter(a),this.leerLicencias(a)]);this.highlightControls();const e=this.byId("564433");e.setText("Guardar");var r=new sap.m.Dialog({title:"Informaci√≥n",type:"Message",state:"Success",content:new sap.m.Text({text:"Datos cargados correctamente"}),beginButton:new sap.m.Button({text:"OK",press:function(){r.close()}}),afterClose:function(){r.destroy()}});r.open()}}catch(e){console.error("Error al obtener los datos del proyecto:",e);sap.m.MessageToast.show("Error al cargar los datos del proyecto")}},fetchMilestones:async function(e){if(!e){console.error("Error: projectID es inv√°lido o indefinido:",e);sap.m.MessageToast.show("Error: ID del proyecto no v√°lido.");return}var t=`/odata/v4/datos-cdo/planificacion?$filter=datosProyect_ID eq '${e}'`;try{const a=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!a.ok){const e=await a.text();throw new Error("Error en la respuesta de la API: "+e)}const s=await a.json();if(!s||!s.value||!Array.isArray(s.value)||s.value.length===0){console.warn("No se encontraron datos de planificaci√≥n para el proyecto:",e);sap.m.MessageToast.show("No hay datos de planificaci√≥n disponibles.");return}s.value.sort((e,t)=>new Date(e.fecha_inicio)-new Date(t.fecha_inicio));var o=this.getView().getModel("planning");let r={};s.value.forEach(e=>{let t=e.fecha_inicio?new Date(e.fecha_inicio).toISOString().split("T")[0]:null;let o=e.fecha_fin?new Date(e.fecha_fin).toISOString().split("T")[0]:null;r[e.hito]={fechaInicio:t,fechaFin:o}});const n=["Kick off","Dise√±o","Construcci√≥n","Pruebas TQ","Go live","Paso AM","Server post/prod"];n.forEach((e,t)=>{let a=`/milestones/${t}`;if(r[e]){o.setProperty(a+"/fechaInicio",r[e].fechaInicio);o.setProperty(a+"/fechaFin",r[e].fechaFin)}else{o.setProperty(a+"/fechaInicio",null);o.setProperty(a+"/fechaFin",null)}});this._idPlani=s.value[0].ID;this.updateVizFrame1(s);console.log("ID de planificaci√≥n recuperado:",this._idPlani)}catch(e){console.error("Error al obtener los datos de planificaci√≥n:",e);sap.m.MessageToast.show("Error al cargar los datos de planificaci√≥n.")}},leerProveedor:async function(e){var t=`/odata/v4/datos-cdo/ProveedoresC?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const n=await e.json();var o=this.byId("table2");var a=o.getItems();if(n.value&&n.value.length>0){var s=n.value[0];var r=s.ID;a.forEach(function(e){var t=e.getCells();if(t.length>1){t[0].setValue(s.valueCondi||"");t[1].setValue(s.valueProvee||"")}this.byId("box_condi").setSelected(s.checkCondi||false);this.byId("box_prove").setSelected(s.checkProveedor||false)}.bind(this));this._proveeID=r}else{console.log("No hay datos de proveedores disponibles.")}}catch(e){console.error("Error al obtener los datos de proveedor:",e);sap.m.MessageToast.show("Error al cargar los datos de proveedor")}},leerFacturacion:async function(e){var t=`/odata/v4/datos-cdo/Facturacion?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();console.log("Datos de Facturaci√≥n:",s);var o=this.byId("table0");var a=o.getItems();if(s.value&&s.value.length>0){s.value.forEach(function(e,t){var o=a[t];var s=o.getCells();if(a[t]){var s=a[t].getCells();if(s.length>1){if(s[0]instanceof sap.m.DatePicker){console.log("Tipo de celda:",s[0].constructor.name);s[0].setDateValue(e.fechaEstimida?new Date(e.fechaEstimida):null)}if(s[1]instanceof sap.m.Input){s[1].setValue(e.descripcionHito||"")}if(s[2]instanceof sap.m.Input){s[2].setValue(e.facturacion||"")}}}});if(s.value[0]&&s.value[0].ID){this._FacturacionID=s.value[0].ID}this.metodoSumarFac()}else{console.log("No hay datos de Facturaci√≥n disponibles.")}}catch(e){console.error("Error al obtener los datos de Facturaci√≥n:",e);sap.m.MessageToast.show("Error al cargar los datos de Facturaci√≥n")}},leerClientFactura:async function(e){var t=`/odata/v4/datos-cdo/ClientFactura?$filter=datosProyect_ID eq ${e}&$orderby=ID asc`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();var o=this.byId("table_clienteFac");var a=o.getItems();if(l.value&&l.value.length>0){let e=l.value.sort((e,t)=>e.ID-t.ID);for(let t=0;t<e.length;t++){let n=e[t];if(t>=a.length){let e=new sap.m.ColumnListItem({cells:[new sap.m.Input({value:n.juridica||""}),new sap.m.Input({value:n.oferta?`${n.oferta}%`:""})]});o.addItem(e);a.push(e)}var s=a[t];var r=s.getCells();if(r[0].getMetadata().getName()==="sap.m.Input"){r[0].setValue(n.juridica||"")}else if(r[0].getMetadata().getName()==="sap.m.Text"){r[0].setText(n.juridica||"")}if(r[1].getMetadata().getName()==="sap.m.Input"){r[1].setValue(n.oferta?`${n.oferta}%`:"")}else if(r[1].getMetadata().getName()==="sap.m.Text"){r[1].setText(n.oferta?`${n.oferta}%`:"")}}}this.metodoSumar();var n=this.byId("box_multiJuridica");var i=n.getSelected();this.onCheckBoxSelectMulti({getSource:()=>n,getSelected:()=>i})}catch(e){console.error("Error al obtener los datos de cliente Facturaci√≥n:",e);sap.m.MessageToast.show("Error al cargar los datos de cliente Facturaci√≥n")}},leerRecursos:async function(e){var t=`/odata/v4/datos-cdo/RecursosInternos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS RECURSOS TRAIDO:",l);var o=this.byId("table_dimicFecha");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;console.log("ID del recurso:",r);if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[2].setSelectedKey(s.PerfilServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalE?parseFloat(s.totalE).toFixed(2):"0.00")}}await this.leerFechas(r);this._recurso_ID=r}else{}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechas:async function(e){console.log("ID RECURSO INTERNO EN  LEER FECHAS "+e);var t=`/odata/v4/datos-cdo/ValorMensuReInter?$filter=RecursosInternos_ID eq '${e}'`;try{const s=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!s.ok){const e=await s.text();throw new Error("Network response was not ok: "+e)}const r=await s.json();console.log("Respuesta JSON completa:",r);if(!r.value||r.value.length===0){throw new Error("No se encontraron datos para el recursoID: "+e)}var o=r.value[0];var a=o.ID;console.log(" ID LEERFECHAS ODATA   "+r);let n={};r.value.forEach(e=>{let t=e.mesAno;n[t]=e.valor});console.log("Valores por fecha antes de enviarlos RECURSO INTERNO:",n);this.fechasDinamicas(n);this._idleerReIn=a}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasServiRecInter:async function(e){console.log("  ID DE LEER SERVI INTER <>>>>>");var t=`/odata/v4/datos-cdo/ValorMensuServReInter?$filter=otrosGastoRecu_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();console.log("Datos obtenidos de la API:",s);var o=s.value[0];var a=o.ID;console.log("ID SERVICIO INTERNO:",s);let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos RECURSO INTERNO:",r);this.fechasDinamicas(r);this._idleerSerInter=a}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasGastoViajeRecInter:async function(e){console.log("id GASTO VIAJE PASADO A MES A√ëO <<<< "+e);var t=`/odata/v4/datos-cdo/ValorMensuGastViaReInter?$filter=otrosRecursos_ID eq '${e}'`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("Response completo:",e);if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();console.log("Respuesta JSON completa:",s);if(!s.value||s.value.length===0){throw new Error("No se encontraron datos en la respuesta de la API.")}var o=s.value[0];var a=o.ID;console.log("ID SERVICIO INTERNO:",s);let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos Gasto viaje Servi INterno :",r);this.fechasDinamicas(r);this._idGastInterno=a}catch(e){console.error("Error al obtener los datos de FECHAS DE GASTOS DE VIAJE :",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasConsumoExterno:async function(e){var t=`/odata/v4/datos-cdo/ValorMensuConsuEx?$filter=ConsumoExternos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO EXTERNO:",r);this._idleeConsu=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de FECHAS DE Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasServConsumoExterno:async function(e){var t=`/odata/v4/datos-cdo/ValorMensuServConsuEx?$filter=otrosServiciosConsu_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO SERVI FECHAS :",r);this._idleeConsu=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de FECHAS DE Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasGastoConsumoExterno:async function(e){console.log("ID RECURSO INTERNO EN  LEER FECHAS "+recursoID);var t=`/odata/v4/datos-cdo/ValorMensuGastoViaConsuEx?$filter=GastoViajeConsumo_ID eq '${e}'`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();console.log("Respuesta JSON completa:",s);if(!s.value||s.value.length===0){throw new Error("No se encontraron datos para el recursoID: "+recursoID)}var o=s.value[0];var a=o.ID;console.log(" ID LEERFECHAS ODATA   "+s);let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos RECURSO INTERNO:",r);this.fechasDinamicas(r);this._idleerReIn=a}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasRecursoExterno:async function(e){console.log("ID de recursos recibido:",e);var t=`/odata/v4/datos-cdo/ValorMensuRecuExter?$filter=RecursosExternos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO EXTERNO:",r);this._idleeRExt=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasServRecursoExterno:async function(e){var t=`/odata/v4/datos-cdo/ValorMensuSerExter?$filter=ServiRecurExterno_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO EXTERNO:",r);this._idleeSerRExt=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasGastoRecursoExterno:async function(e){var t=`/odata/v4/datos-cdo/ValorMensuGastoViExter?$filter=GastoViajeRecExter_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO EXTERNO:",r);this._idleeGasRExt=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerGastoviajeInterno:async function(e){var t=`/odata/v4/datos-cdo/otrosRecursos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS GASTO VIAJE INTERNO TRAIDO: -----\x3e ",l);var o=this.byId("table0_1727879940116");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;console.log("ID ERRORRR "+r);if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalE?parseFloat(s.totalE).toFixed(2):"0.00")}}await this.leerFechasGastoViajeRecInter(r);this._RecuOtrse=r}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerSerivioInterno:async function(e){var t=`/odata/v4/datos-cdo/otrosGastoRecu?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS Servicio interno : -----\x3e ",l);var o=this.byId("table0_1727879576857");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalE?parseFloat(s.totalE).toFixed(2):"0.00")}}this._idlSErvi=r;await this.leerFechasServiRecInter(r)}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerConsumoExterno:async function(e){var t=`/odata/v4/datos-cdo/ConsumoExternos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS ConsumoExternos TRAIDO:",l);var o=this.byId("tablaConsuExter");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[2].setSelectedKey(s.PerfilServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerFechasConsumoExterno(r);this._idConsum=r;console.log("LEER CONSUMO ID   "+r)}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerConsuOtroServi:async function(e){var t=`/odata/v4/datos-cdo/otrosServiciosConsu?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();var o=this.byId("idOtroserConsu");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idConOS=r;await this.leerFechasServConsumoExterno(r)}else{}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerGastoViajeConsu:async function(e){var t=`/odata/v4/datos-cdo/GastoViajeConsumo?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();var o=this.byId("idGastoViajeConsu");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idCviajO=r;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idCviajO=r}else{}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerRecursoExterno:async function(e){var t=`/odata/v4/datos-cdo/RecursosExternos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos traidos RecursosExternos TRAIDO:",l);var o=this.byId("tablaRecExterno");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[2].setSelectedKey(s.PerfilServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setValue(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerFechasRecursoExterno(r);this._idRecEx=r}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerOtrosServiExter:async function(e){var t;var o=`/odata/v4/datos-cdo/serviRecurExter?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(o,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();var a=this.byId("idServiExterno");var s=a.getItems();if(l.value&&l.value.length>0){var r=l.value[0];t=r.ID;if(s.length>0){var n=s[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(r.Vertical_ID||"");i[1].setSelectedKey(r.tipoServicio_ID||"");i[3].setValue(r.ConceptoOferta||"");i[4].setText(r.PMJ?parseFloat(r.PMJ).toFixed(2):"0.00");i[5].setText(r.year1?parseFloat(r.year1).toFixed(2):"0.00");i[6].setText(r.year2?parseFloat(r.year2).toFixed(2):"0.00");i[7].setText(r.year3?parseFloat(r.year3).toFixed(2):"0.00");i[8].setText(r.year4?parseFloat(r.year4).toFixed(2):"0.00");i[9].setText(r.year5?parseFloat(r.year5).toFixed(2):"0.00");i[10].setText(r.year6?parseFloat(r.year6).toFixed(2):"0.00");i[11].setText(r.total?parseFloat(r.total).toFixed(2):"0.00");i[12].setText(r.totalC?parseFloat(r.total).toFixed(2):"0.00")}}this._RecSeX=t;await this.leerFechasServRecursoExterno(t)}else{console.log("No hay datos de servi Externos  disponibles.")}}catch(e){console.error("Error al obtener los datos de serviRecurExter:",e);sap.m.MessageToast.show("Error al cargar los datos de serviRecurExter")}},leerGastoViaExter:async function(e){var t=`/odata/v4/datos-cdo/GastoViajeRecExter?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos traidos GastoViajeRecExter TRAIDO:",l);var o=this.byId("idGastoRecuExter");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idReExGas=r;await this.leerFechasGastoRecursoExterno(r)}else{console.log("No hay datos de GastoViajeRecExter  disponibles.")}}catch(e){console.error("Error al obtener los datos de GastoViajeRecExter:",e);sap.m.MessageToast.show("Error al cargar los datos de GastoViajeRecExter")}},leerOtrosConcepto:async function(e){var t=`/odata/v4/datos-cdo/otrosConceptos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos traidos otrosConceptos TRAIDO:",l);var o=this.byId("table0_1724413700665");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[2].setValue(s.ConceptoOferta||"");i[3].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[4].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[5].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[6].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[7].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[8].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[9].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[10].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[11].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._otrC=r;await this.leerFechasOtrosConcetos(r)}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasOtrosConcetos:async function(e){var t=`/odata/v4/datos-cdo/ValorMensuOtrConcep?$filter=otrosConceptos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO EXTERNO:",r);this._otroConcep=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechasLicencia:async function(e){var t=`/odata/v4/datos-cdo/ValorMensulicencia?$filter=licencia_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var o=s.value[0];var a=o.ID;let r={};s.value.forEach(e=>{let t=e.mesAno;r[t]=e.valor});console.log("Valores por fecha antes de enviarlos  CONSUMO EXTERNO:",r);this._LicenciaId=a;this.fechasDinamicas(r)}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerLicencias:async function(e){var t=`/odata/v4/datos-cdo/LicenciasCon?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();var o=this.byId("table0_1727955577124");var a=o.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(a.length>0){var n=a[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[2].setValue(s.ConceptoOferta||"");i[3].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[4].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[5].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[6].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[7].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[8].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[9].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[10].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[11].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idLinc=r;await this.leerFechasLicencia(r)}else{console.log("No hay datos de LicenciasCon disponibles.")}}catch(e){console.error("Error al obtener los datos de LicenciasCon:",e);sap.m.MessageToast.show("Error al cargar los datos de LicenciasCon")}},updateVizFrame1:function(e){var t=this.getView();var o=t.getModel("planning");if(!o){console.error("El modelo 'planning' no est√° definido.");return}if(!e||!e.value){return}var a=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});var s=e.value.map(function(e){var t=e.fecha_inicio?new Date(e.fecha_inicio):null;var o=e.fecha_fin?new Date(e.fecha_fin):null;if(t&&!isNaN(t.getTime())&&o&&!isNaN(o.getTime())){var s=(o-t)/(1e3*60*60*24);return{fase:e.hito,fechaInicio:a.format(t),fechaFin:a.format(o),duracion:s,label:`Inicio: ${a.format(t)}, Fin: ${a.format(o)}, Duraci√≥n: ${s} d√≠as`}}else{console.warn("Fechas no v√°lidas para el hito:",e);return null}}).filter(Boolean);o.setProperty("/chartData",s);console.log(s);this._aChartData=s;var r={};s.forEach(function(e){if(e.fase==="Kick off"){r.fechaInicioConstruccion=e.fechaInicio}if(e.fase==="Server post/prod"){r.fechaFinPruebasTQ=e.fechaFin}});var n=new sap.ui.model.json.JSONModel({fechas:[{fase:"Plan",fechaInicioConstruccion:r.fechaInicioConstruccion||"No definida",fechaFinPruebasTQ:r.fechaFinPruebasTQ||"No definida"}]});t.setModel(n,"fechasModel");this.updateVizFrame2(n)},updateVizFrame2:function(e){var t=this.getView();var o=t.getModel("planning");if(!(e instanceof sap.ui.model.json.JSONModel)||!e.getData){return}var a=e.getData().fechas;var s=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});var r=a.map(function(e){var t=e.fechaInicioConstruccion&&e.fechaInicioConstruccion!=="No definida"?new Date(e.fechaInicioConstruccion):null;var o=e.fechaFinPruebasTQ&&e.fechaFinPruebasTQ!=="No definida"?new Date(e.fechaFinPruebasTQ):null;if(t&&!isNaN(t.getTime())&&o&&!isNaN(o.getTime())){var a=(o-t)/(1e3*60*60*24);return{fase:e.fase,fechaInicio:s.format(t),fechaFin:s.format(o),duracion:a,label:`Inicio: ${s.format(t)}, Fin: ${s.format(o)}, Duraci√≥n: ${a} d√≠as`}}else{return null}}).filter(Boolean);o.setProperty("/chartModel",r)},updateVizFrame3:function(){var e=this.getView();var t=e.getModel("planning");var o=t.getData();var a=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});var s=o.milestones.map(function(e){var t=e.fechaInicio?new Date(e.fechaInicio):null;var o=e.fechaFin?new Date(e.fechaFin):null;if(t&&o&&!isNaN(t)&&!isNaN(o)){var s=(o-t)/(1e3*60*60*24);return{fase:e.fase,fechaInicio:a.format(t),fechaFin:a.format(o),duracion:s,label:`Inicio: ${a.format(t)}, Fin: ${a.format(o)}, Duraci√≥n: ${s} d√≠as`}}else{return null}}).filter(Boolean);t.setProperty("/chartData",s);this._aChartData=s;var r={};s.forEach(function(e){if(e.fase==="Kick off"){r.fechaInicioConstruccion=e.fechaInicio}if(e.fase==="Server post/prod"){r.fechaFinPruebasTQ=e.fechaFin}});var n=new sap.ui.model.json.JSONModel({fechas:[{fase:"Fechas Importantes",fechaInicioConstruccion:r.fechaInicioConstruccion,fechaFinPruebasTQ:r.fechaFinPruebasTQ}]});e.setModel(n,"fechasModel");this.updateVizFrame2(n)},onFechaChange:function(){this.updateVizFrame1();this.updateVizFrame3()},onPerfilChangeTabla1:function(e){this.updateRowData(e,["table_dimicFecha"])},updateRowData:function(e){const t=e.getSource();var o=this.byId("table_dimicFecha");var a=t.getParent();var s=o.indexOfItem(a);if(s===-1){console.error(`√çndice de la fila no encontrado en la tabla ${oTableId}. Verifica la estructura de la tabla.`);return}else{}var r=o.getItems();var n=r[s].getCells();if(!n||n.length===0){console.error(`Datos de la fila no encontrados en la tabla ${oTableId}.`);return}var i=t.getSelectedItem().getText();var l={Director:{PMJ:1370.88,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"CG4.C":{PMJ:179.46,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"CG4.A":{PMJ:347.37,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"CG4.B":{PMJ:223.59,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},CG3:{PMJ:424.15,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},CG2:{PMJ:529.92,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},CG1:{PMJ:670.46,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0}};var c=l[i];if(c){n[4].setText(c.PMJ);n[5].setText(c["2024"]);n[6].setText(c["2025"]);n[7].setText(c["2026"]);n[8].setText(c["2027"]);n[9].setText(c["2028"]);n[10].setText(c["2029"]);var d=0;n[11].setText(d);var u=0;n[12].setText(u);console.log(u)}else{console.error(`No hay configuraci√≥n definida para el valor seleccionado: ${i}`)}},selectFuncionchange:function(e){const t=e.getSource();const o=this.byId("tablaConsuExter");var a=t.getParent();var s=o.indexOfItem(a);if(s===-1){console.error(`√çndice de la fila no encontrado en la tabla ${oTableId}. Verifica la estructura de la tabla.`);return}var r=o.getItems();var n=r[s].getCells();if(!n||n.length===0){console.error(`Datos de la fila no encontrados en la tabla ${oTableId}.`);return}var i=t.getSelectedItem().getText();var l={"Equipo Argentina - Analista":{PMJ:216.18,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Equipo Argentina - Asistente":{PMJ:190.74,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Equipo Argentina - Jefe":{PMJ:296.13,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Equipo Argentina - Gerente":{PMJ:478.34,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Basis - Consultor Junior":{PMJ:207.19,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Basis - Consultor Senior":{PMJ:356.21,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Basis - Arquitecto":{PMJ:356.21,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"QA - An√°lisis Funcional":{PMJ:278,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"QA - Jefe Proyecto":{PMJ:320,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Testing - An√°lisis Funcional":{PMJ:180,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"TA - Consultor Senior 1-2":{PMJ:379.17,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"TA - Consultor Senior 3":{PMJ:455.4,2024:.93,2025:0,2026:0,2027:0,2028:0,2029:0}};var c=l[i];if(c){n[4].setText(c.PMJ);n[5].setText(c["2024"]);n[6].setText(c["2025"]);n[7].setText(c["2026"]);n[8].setText(c["2027"]);n[9].setText(c["2028"]);n[10].setText(c["2029"]);var d=0;n[11].setText(d);var u=0;n[12].setText(u);console.log(u)}else{console.error(`No hay configuraci√≥n definida para el valor seleccionado: ${i}`)}},token:async function(){try{let e=await fetch("/odata/v4/datos-cdo",{method:"GET",headers:{"x-csrf-token":"Fetch"}});if(!e.ok){throw new Error("Error al obtener el CSRF Token")}let t=e.headers.get("x-csrf-token");if(!t){throw new Error("No se recibi√≥ un CSRF Token")}console.log("CSRF Token obtenido:",t);localStorage.setItem("csrfToken",t);this._sCsrfToken=t}catch(e){console.error("Error en la llamada al servicio:",e);sap.m.MessageToast.show("Error al procesar el proyecto: "+e.message)}},getCsrfToken:function(){return localStorage.getItem("csrfToken")},sendRequest:async function(){const e=this.getCsrfToken();if(!e){console.log("No hay CSRF Token disponible, obteniendo uno...");await this.token()}const t=await fetch("/odata/v4/datos-cdo",{method:"GET",headers:{"x-csrf-token":e}});if(t.ok){const e=await t.json();console.log(e)}else{console.error("Error en la solicitud:",t.status)}},onSave:async function(){let e=0;const t=[];const o=this._sProjectID;const a=parseInt(this.byId("input0").getValue(),10);const s=this.byId("dddtg").getText();const r=this.byId("23d3").getText();const n=this.byId("input1").getValue();const i=this.byId("idDescripcion").getValue();const l=parseInt(this.byId("input0_1725625161348").getValue(),10);const c=this.byId("box_pluriAnual").getSelected();const d=this.byId("id_Cfactur").getValue();const u=this.byId("box_multiJuridica").getSelected();const h=this.byId("int_clienteFun").getValue();const f=this.byId("idObje").getValue();const p=this.byId("idAsunyRestri").getValue();const g=this.byId("area0").getValue();const x=this.byId("date_inico").getDateValue();const y=this.byId("date_fin").getDateValue();const T=this.byId("input_ipc").getValue();var m=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd'T'HH:mm:ss"});const v=x?m.format(x):null;const I=y?m.format(y):null;const b=this.byId("idNatu").getSelectedKey();const C=this.byId("slct_area").getSelectedKey();const w=this.byId("slct_Jefe").getSelectedKey();const F=this.byId("slct_inic").getSelectedKey();const E=this.byId("selc_Segui").getSelectedKey();const S=this.byId("selc_ejcu").getSelectedKey();const _=this.byId("slct_client").getSelectedKey();const N=this.byId("slct_verti").getSelectedKey();const V=this.byId("selct_Amrecp").getSelectedKey();const D=(o,a,s)=>{if(!a||typeof a==="string"&&a.trim()===""){o.setValueState("Error");o.setValueStateText("Este campo es obligatorio");e++;if(!t.includes(s)){t.push(s)}}else{o.setValueState("None")}};D(this.byId("input1"),n,"Nombre del Proyecto");D(this.byId("idDescripcion"),i,"Descripcion");if(e>0){sap.m.MessageBox.warning(`Por favor, complete los siguientes campos: ${t.join(", ")}`,{title:"Advertencia"});return}const P=new Date;const R=new Date(P.getTime()-P.getTimezoneOffset()*6e4);const O={codigoProyect:"1",nameProyect:n,Email:s,Empleado:r,fechaCreacion:R,pluriAnual:c,Total:l,descripcion:i,funcionalString:h,clienteFacturacion:d,multijuridica:u,Naturaleza_ID:b,Area_ID:C,Iniciativa_ID:F,jefeProyectID_ID:w,objetivoAlcance:f,AsuncionesyRestricciones:p,Vertical_ID:N,Fechainicio:v,FechaFin:I,Seguimiento_ID:E,EjecucionVia_ID:S,AmReceptor_ID:V,clienteFuncional_ID:_,Estado:"Pendiente",datosExtra:g,IPC_apli:T};if(!O.descripcion||!O.nameProyect){sap.m.MessageToast.show("Error: C√≥digo y nombre del proyecto son obligatorios.");console.error("Validaci√≥n fallida: Falta c√≥digo o nombre del proyecto",O);return}console.log("Payload a enviar:",JSON.stringify(O,null,2));try{let e=this.getView().getModel();let t=e.sServiceUrl;let a;let s="/odata/v4/datos-cdo/DatosProyect";let r="POST";if(o){s=`/odata/v4/datos-cdo/DatosProyect(${o})`;r="PATCH"}let n=await fetch(t,{method:"GET",headers:{"x-csrf-token":"Fetch"}});if(!n.ok){throw new Error("Error al obtener el CSRF Token")}let i=n.headers.get("x-csrf-token");if(!i){throw new Error("No se recibi√≥ un CSRF Token")}console.log("‚úÖ CSRF Token obtenido:",i);a=await fetch(s,{method:r,headers:{"Content-Type":"application/json","x-csrf-token":i},body:JSON.stringify(O)});if(!a.ok){const e=await a.text();console.error(`Error en ${r} (${a.status}):`,e);if(a.status===400){sap.m.MessageToast.show("Error 400: Datos incorrectos o incompletos.")}else if(a.status===404){sap.m.MessageToast.show("Error 404: Endpoint no encontrado.")}else if(a.status===500){sap.m.MessageToast.show("Error 500: Problema en el servidor o base de datos.")}else{sap.m.MessageToast.show(`Error ${a.status}: ${e}`)}throw new Error(`HTTP ${a.status} - ${e}`)}if(a.ok){const e=await a.json();console.log("Respuesta completa de la API:",e);const t=e.ID||e.data?.ID;console.log("ID generado:",t);if(t){await Promise.all([this.insertFacturacion(t),this.inserChart(t,i),this.insertarProveedor(t),this.insertClientFactura(t),this.insertRecursosInternos(t),this.insertCosumoExterno(t),this.insertRecursoExterno(t),this.insertarOtrosConceptos(t),this.insertServicioInterno(t),this.insertGastoViajeInterno(t),this.insertServiConsu(t),this.insertGastoConsu(t),this.insertServicioRecuExter(t),this.insertGastoViajeExterno(t),this.insertarLicencia(t)]);this.getOwnerComponent().getRouter().navTo("app",{newId:t})}else{console.error("No se gener√≥ un ID v√°lido.");sap.m.MessageToast.show("Error: No se gener√≥ un ID v√°lido.")}}}catch(e){console.error("Error en la llamada al servicio:",e);sap.m.MessageToast.show("Error al procesar el proyecto: "+e.message)}},inserChart:async function(e,t){const o=this._aChartData;const a=this._idPlani;const s=o.map(t=>({hito:t.fase,fecha_inicio:t.fechaInicio,fecha_fin:t.fechaFin,duracion:this.formatDuration(t.duracion),datosProyect_ID:e}));try{let o;const a=await fetch(`/odata/v4/datos-cdo/planificacion?$filter=datosProyect_ID eq '${e}'`,{headers:{"x-csrf-token":t}});const r=await a.json();const n=r.value.map(e=>e.hito);for(const e of s){if(n.includes(e.hito)){const o=r.value.find(t=>t.hito===e.hito);console.log("TENEMOS "+JSON.stringify(o));if(o&&o.id){const a=await fetch(`/odata/v4/datos-cdo/planificacion(${o.id})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(e)});if(a.ok){const e=await a.json();console.log("Planificaci√≥n actualizada con √©xito:",e)}else{const e=await a.text();console.log("Error al actualizar la planificaci√≥n:",e);sap.m.MessageToast.show("Error al actualizar la planificaci√≥n: "+e)}}else{console.log("ID no v√°lido para el registro a actualizar:",o);sap.m.MessageToast.show("Error al actualizar: ID no v√°lido.")}}else{const o=await fetch("/odata/v4/datos-cdo/planificacion",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(e)});if(o.ok){const e=await o.json();console.log("Planificaci√≥n guardada con √©xito:",e)}else{const e=await o.text();console.log("Error al guardar la planificaci√≥n:",e);sap.m.MessageToast.show("Error al guardar la planificaci√≥n: "+e)}}}}catch(e){console.error("Error en la operaci√≥n:",e);sap.m.MessageToast.show("Ocurri√≥ un error durante la operaci√≥n.")}},insertFacturacion:async function(e){console.log("ID RECIBIDOOO   "+e);const t=this._sCsrfToken;const o=this.byId("table0");const a=o.getItems();const s=[];const r=parseInt(this.byId("text73_172746565340569997").getText(),10);const n=this._FacturacionID;console.log("Total facturaci√≥n:",r);a.forEach(function(t){const o=t.getCells();let a="";if(o[0]){if(typeof o[0].getDateValue==="function"){const e=o[0].getDateValue();if(e&&!isNaN(e.getTime())){a=e.toISOString().split("T")[0]}}else if(typeof o[0].getValue==="function"){const e=o[0].getValue();const t=e.split("/");if(t.length===3){const e=new Date(t[2],t[1]-1,t[0]);if(!isNaN(e.getTime())){a=e.toISOString().split("T")[0]}}}}const n=o[1]&&o[1].getValue?o[1].getValue():"";const i=o[2]&&o[2].getValue?parseInt(o[2].getValue(),10):0;if(a){s.push({fechaEstimida:a,descripcionHito:n,facturacion:i,total:r,datosProyect_ID:e})}});for(let e of s){let o="POST";let a="/odata/v4/datos-cdo/Facturacion";let s={...e};console.log("Enviando datos: ",JSON.stringify(s));if(n){if(n&&typeof n==="string"){o="PATCH";a=`/odata/v4/datos-cdo/Facturacion(${n})`}else{console.error("ID de facturaci√≥n no v√°lido:",n);sap.m.MessageToast.show("Error: ID de facturaci√≥n no v√°lido");return}}const r=await fetch(a,{method:o,headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(s)});if(r.ok){const e=await r.json();console.log("Facturaci√≥n guardada/actualizada:",e)}else{const e=await r.text();console.error("Error al guardar la Facturaci√≥n:",e);sap.m.MessageToast.show("Error al guardar la Facturaci√≥n: "+e)}}},insertarProveedor:async function(e,t){const o=this._sCsrfToken;console.log("TOKEN RECIBIDO EN PROVEEDOR:",o);var a=this.byId("table2");var s=a.getItems();var r=[];s.forEach(function(t){var o=t.getCells();var a=o[0].getValue();var s=o[1].getValue();var n=this.byId("box_condi").getSelected();var i=this.byId("box_prove").getSelected();r.push({checkCondi:n,checkProveedor:i,valueCondi:a,valueProvee:s,datosProyect_ID:e})}.bind(this));let n;for(let a of r){if(t){let s=await fetch(`/odata/v4/datos-cdo/ProveedoresC?$filter=datosProyect_ID eq '${t}'`);let r=await s.json();if(r.value&&r.value.length>0){let e=r.value[0].ID;n=await fetch(`/odata/v4/datos-cdo/ProveedoresC(${e})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(a)})}else{a.datosProyect_ID=e;n=await fetch("/odata/v4/datos-cdo/ProveedoresC",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(a)})}}else{a.datosProyect_ID=e;n=await fetch("/odata/v4/datos-cdo/ProveedoresC",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(a)})}let s=await n.json()}},insertRecursosInternos:async function(e){const t=this._sCsrfToken;const o=this._recurso_ID;console.log("ENTRANDO A RECURSO INTERNO -----\x3e>>> "+o);const a=this.byId("table_dimicFecha");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0]?.getSelectedKey()||"";const i=r.getCells()[1]?.getSelectedKey()||"";const l=r.getCells()[2]?.getSelectedKey()||"";const c=r.getCells()[3]?.getValue()||"";const d=this.convertToInt(r.getCells()[4]?.getText()||"0");const u=parseInt(r.getCells()[5]?.getText()||"0",10);const h=parseInt(r.getCells()[6]?.getText()||"0",10);const f=parseInt(r.getCells()[7]?.getText()||"0",10);const p=parseInt(r.getCells()[8]?.getText()||"0",10);const g=parseInt(r.getCells()[9]?.getText()||"0",10);const x=parseInt(r.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(r.getCells()[11]?.getText()||"0");const T=this.convertToInt(r.getCells()[12]?.getText()||"0");if(!n||!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const m={Vertical_ID:n,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(f.toFixed(2)),year4:Number(p.toFixed(2)),year5:Number(g.toFixed(2)),year6:Number(x.toFixed(2)),total:Number(y.toFixed(2)),totalE:Number(T.toFixed(2)),tipoServicio_ID:i,PerfilServicio_ID:l,datosProyect_ID:e};console.log("ID DE ACTUALIZACION -----\x3e>>>>",o);let v;if(o){v=await fetch(`/odata/v4/datos-cdo/RecursosInternos(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}else{v=await fetch("/odata/v4/datos-cdo/RecursosInternos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(v.ok){const e=await v.json();console.log("üìå Respuesta completa de la API:",e);const t=e.ID;console.log("üìå ID de Recurso obtenido:",t);if(!t){console.error("‚ö†Ô∏è La API no devolvi√≥ un ID v√°lido.");return}this._RecursoInt=t;await this.InsertMesA√±oRecurInterno(r,t);console.log("TERMINANDO  RECURSOS------");console.log("Fila "+(a+1)+" guardada con √©xito: RECURSOS INTERNOS",e)}else{const e=await v.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}},"InsertMesA√±oRecurInterno":async function(e,t){const o=this._sCsrfToken;const a=this._idleerReIn;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={RecursosInternos_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuReInter(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuReInter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±oServRecurInterno":async function(e,t){const o=this._sCsrfToken;const a=this._idleerSerInter;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={otrosGastoRecu_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuServReInter(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuServReInter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±oGastoViajRecuInterno":async function(e,t){const o=this._sCsrfToken;const a=this._idGastInterno;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={otrosRecursos_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuGastViaReInter(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuGastViaReInter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},convertToInt:function(e){const t=parseInt(e,10);return isNaN(t)?0:t},"InsertmesA√±oConsumoExterno":async function(e,t){const o=this._sCsrfToken;const a=this._idleeConsu;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={ConsumoExternos_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuConsuEx(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuConsuEx",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertmesA√±oServConExterno":async function(e,t){const o=this._sCsrfToken;const a=this._idConOS;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={otrosServiciosConsu_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuServConsuEx(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuServConsuEx",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertmesA√±oGViajeConExterno":async function(e,t){const o=this._sCsrfToken;const a=this._idCviajO;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={GastoViajeConsumo_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuGastoViaConsuEx(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuGastoViaConsuEx",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±oRecursoExterno":async function(e,t){const o=this._sCsrfToken;const a=this._idleeRExt;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={RecursosExternos_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuRecuExter(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuRecuExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±osSerRecursoExterno":async function(e,t){const o=this._sCsrfToken;const a=this._idleeSerRExt;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={ServiRecurExterno_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuSerExter(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuSerExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±osGastoRecursoExterno":async function(e,t){const o=this._sCsrfToken;const a=this._idleeGasRExt;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={GastoViajeRecExter_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuGastoViExter(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuGastoViExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±osOtrosConceptos":async function(e,t){const o=this._sCsrfToken;const a=this._otroConcep;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={otrosConceptos_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensuOtrConcep(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensuOtrConcep",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},"InsertMesA√±osLicencia":async function(e,t){const o=this._sCsrfToken;const a=this._LicenciaId;const s={};const r=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const o=e.getCells()[t];let a;if(typeof o.getValue==="function"){a=o.getValue()}else if(typeof o.getText==="function"){a=o.getText()}else{console.warn(`Tipo de celda inesperado en la columna din√°mica (√≠ndice ${t}):`,o);continue}if(a===null||a===undefined||a===""){console.warn(`Celda vac√≠a o nula en columna ${t}, se omite el env√≠o para esta columna.`);continue}let n=`Columna_${t}`;if(r[t]){const e=r[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en √≠ndice ${t}`)}if(n.toLowerCase().includes("total")){console.warn(`Se omite la columna ${n} porque es un total.`);continue}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,a);s[n]=this.convertToInt(a)}console.log("Datos a enviar:",s);for(const[e,r]of Object.entries(s)){if(r===null||r===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const s={licencia_ID:t,mesAno:e,valor:r};console.log("Payload preparado para enviar:",s);let n;try{if(a){n=await fetch(`/odata/v4/datos-cdo/ValorMensulicencia(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}else{n=await fetch("/odata/v4/datos-cdo/ValorMensulicencia",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},body:JSON.stringify(s)})}if(!n.ok){const e=await n.text();throw new Error(`Error en la llamada al servicio: ${n.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con √©xito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},insertServicioInterno:async function(e){const t=this._sCsrfToken;let o;const a=this._idlSErvi;const s=this.byId("table0_1727879576857");const r=s.getItems();for(let s=0;s<r.length;s++){const n=r[s];const i=n.getCells()[0].getSelectedKey();const l=n.getCells()[1].getSelectedKey();const c=n.getCells()[3].getValue();const d=this.convertToInt(n.getCells()[4].getText());const u=parseInt(n.getCells()[5]?.getText()||"0",10);const h=parseInt(n.getCells()[6]?.getText()||"0",10);const f=parseInt(n.getCells()[7]?.getText()||"0",10);const p=parseInt(n.getCells()[8]?.getText()||"0",10);const g=parseInt(n.getCells()[9]?.getText()||"0",10);const x=parseInt(n.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(n.getCells()[11].getText());const T=this.convertToInt(n.getCells()[12].getText());if(!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(s+1)+" correctamente.");return}const m={Vertical_ID:i,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(f.toFixed(2)),year4:Number(p.toFixed(2)),year5:Number(g.toFixed(2)),year6:Number(x.toFixed(2)),total:Number(y),totalE:T,tipoServicio_ID:l,datosProyect_ID:e};try{if(a){o=await fetch(`/odata/v4/datos-cdo/otrosGastoRecu(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}else{o=await fetch("/odata/v4/datos-cdo/otrosGastoRecu",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(o.ok){const e=await o.json();const t=e.ID;this._idOtrosGastos=t;await this.InsertMesA√±oServRecurInterno(n,t);console.log("Fila "+(s+1)+" guardada con √©xito: INSERT OTROS GASTOS ",e)}else{const e=await o.text();console.error("Error al guardar la fila "+(s+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(s+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(s+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(s+1)+": "+e.message)}}},insertGastoViajeInterno:async function(e){const t=this._sCsrfToken;const o=this._RecuOtrse;const a=this.byId("table0_1727879940116");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const f=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const g=parseInt(r.getCells()[10]?.getText()||"0",10);const x=this.convertToInt(r.getCells()[11].getText());const y=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||isNaN(c)||isNaN(x)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(f.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(g.toFixed(2)),total:Number(x.toFixed(2)),totalE:y,tipoServicio_ID:i,datosProyect_ID:e};let m;try{if(o){m=await fetch(`/odata/v4/datos-cdo/otrosRecursos(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{m=await fetch("/odata/v4/datos-cdo/otrosRecursos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(m.ok){const e=await m.json();const t=e.ID;this._idOtrosRecu=t;await this.InsertMesA√±oGastoViajRecuInterno(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: OTROS RECURSOS ",e)}else{const e=await m.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertCosumoExterno:async function(e){const t=this._sCsrfToken;const o=this._idConsum;console.log("ID CONSUMO EXTERNO "+o);const a=this.byId("tablaConsuExter");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey()||"ValorPorDefecto";const i=r.getCells()[1].getSelectedKey()||"ValorPorDefecto";const l=r.getCells()[2].getSelectedKey()||"ValorPorDefecto";const c=r.getCells()[3].getValue()||"";const d=this.convertToInt(r.getCells()[4].getText())||0;const u=parseInt(r.getCells()[5]?.getText()||"0",10);const h=parseInt(r.getCells()[6]?.getText()||"0",10);const f=parseInt(r.getCells()[7]?.getText()||"0",10);const p=parseInt(r.getCells()[8]?.getText()||"0",10);const g=parseInt(r.getCells()[9]?.getText()||"0",10);const x=parseInt(r.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(r.getCells()[11].getText())||0;const T=this.convertToInt(r.getCells()[12].getText())||0;if(!n||!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const m={Vertical_ID:n,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(f.toFixed(2)),year4:Number(p.toFixed(2)),year5:Number(g.toFixed(2)),year6:Number(x.toFixed(2)),total:y,totalC:T,tipoServicio_ID:i,PerfilConsumo_ID:l,datosProyect_ID:e};console.log("-----\x3e>>>> DATOS TRAIDOS CONSUMO EXTERNO ----- ",m);let v;if(o){console.log("Entrando a PATCH");v=await fetch(`/odata/v4/datos-cdo/ConsumoExternos(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}else{v=await fetch("/odata/v4/datos-cdo/ConsumoExternos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(v.ok){const e=await v.json();const t=e.ID;await this.InsertmesA√±oConsumoExterno(r,t);this._ConsuExt=t;this._idRecursos=t;console.log("Fila "+(a+1)+" guardada con √©xito: CONSUMO EXTERNO",e)}else{const e=await v.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}},insertServiConsu:async function(e){const t=this._sCsrfToken;const o=this._idConOS;const a=this.byId("idOtroserConsu");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const f=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const g=parseInt(r.getCells()[10]?.getText()||"0",10);const x=this.convertToInt(r.getCells()[5].getText());const y=this.convertToInt(r.getCells()[6].getText());if(!n||!i||!l||isNaN(c)||isNaN(x)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(f.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(g.toFixed(2)),total:Number(x.toFixed(2)),totalE:y,tipoServicio_ID:i,datosProyect_ID:e};let m;try{if(o){m=await fetch(`/odata/v4/datos-cdo/otrosServiciosConsu(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{m=await fetch("/odata/v4/datos-cdo/otrosServiciosConsu",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(m.ok){const e=await m.json();const t=e.ID;this._idSerConsu=t;await this.InsertmesA√±oServConExterno(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: INSERT SERVI ",e)}else{const e=await m.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertGastoConsu:async function(e){const t=this._sCsrfToken;const o=this._idGasVi;const a=this.byId("idGastoViajeConsu");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const f=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const g=parseInt(r.getCells()[10]?.getText()||"0",10);const x=this.convertToInt(r.getCells()[11].getText());const y=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||isNaN(c)||isNaN(x)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(f.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(g.toFixed(2)),total:x,totalE:y,tipoServicio_ID:i,datosProyect_ID:e};let m;try{if(o){m=await fetch(`/odata/v4/datos-cdo/GastoViajeConsumo(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{m=await fetch("/odata/v4/datos-cdo/GastoViajeConsumo",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(m.ok){const e=await m.json();const t=e.ID;this._idGasViaConsu=t;await this.InsertmesA√±oGViajeConExterno(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: INSERTVIAJES CONSUMO ",e)}else{const e=await m.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertRecursoExterno:async function(e){console.log("ENTRANDO A RECURSOS EXTERNOS ");const t=this._sCsrfToken;const o=this._idRecEx;const a=this.byId("tablaRecExterno");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey()||"";const i=r.getCells()[1].getSelectedKey()||"";const l=r.getCells()[2].getValue()?.trim()||"";const c=r.getCells()[3].getValue()?.trim()||"";const d=this.convertToInt(r.getCells()[4].getValue())||0;const u=parseInt(r.getCells()[5]?.getText()||"0",10);const h=parseInt(r.getCells()[6]?.getText()||"0",10);const f=parseInt(r.getCells()[7]?.getText()||"0",10);const p=parseInt(r.getCells()[8]?.getText()||"0",10);const g=parseInt(r.getCells()[9]?.getText()||"0",10);const x=parseInt(r.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(r.getCells()[11].getText())||0;const T=this.convertToInt(r.getCells()[12].getText())||0;if(!n&&!i&&!l&&!c&&d===0&&y===0&&T===0){console.warn("Fila",a+1,"est√° vac√≠a, se omite.");continue}const m={Vertical_ID:n,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(f.toFixed(2)),year4:Number(p.toFixed(2)),year5:Number(g.toFixed(2)),year6:Number(x.toFixed(2)),total:y,totalR:T,tipoServicio_ID:i,PerfilServicio:l,datosProyect_ID:e};console.log("Payload enviado:",JSON.stringify(m,null,2));console.log("DATOS RECU EXTRA  "+JSON.stringify(m,null,2));let v;try{if(o){v=await fetch(`/odata/v4/datos-cdo/RecursosExternos(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}else{v=await fetch("/odata/v4/datos-cdo/RecursosExternos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(v.ok){const e=await v.json();const t=e.ID;await this.InsertMesA√±oRecursoExterno(r,t);this._idRecursoEx=t;console.log("Fila "+(a+1)+" guardada con √©xito:RECURSO EXTERNO",e)}else{const e=await v.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertServicioRecuExter:async function(e){console.log("he entrado a SERVICIO EXT ");const t=this._sCsrfToken;const o=this._RecSeX;console.log("<<<<< ID  SERVICIO EXT >>>>> "+o);const a=this.byId("idServiExterno");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const f=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const g=parseInt(r.getCells()[10]?.getText()||"0",10);const x=this.convertToInt(r.getCells()[11].getText());const y=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||isNaN(c)||isNaN(x)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(f.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(g.toFixed(2)),total:x,totalE:y,tipoServicio_ID:i,datosProyect_ID:e};let m;if(o){m=await fetch(`/odata/v4/datos-cdo/serviRecurExter(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{m=await fetch("/odata/v4/datos-cdo/serviRecurExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(m.ok){const e=await m.json();const t=e.ID;this._idServiExterno=t;await this.InsertMesA√±osSerRecursoExterno(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: SERVICIO EXTERNO  ",e)}else{const e=await m.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}},insertGastoViajeExterno:async function(e){const t=this._sCsrfToken;const o=this._idReExGas;console.log(" ide de GSTO EXT   "+o);const a=this.byId("idGastoRecuExter");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const f=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const g=parseInt(r.getCells()[10]?.getText()||"0",10);const x=this.convertToInt(r.getCells()[11].getText());const y=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||isNaN(c)||isNaN(x)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(f.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(g.toFixed(2)),total:x,totalE:y,tipoServicio_ID:i,datosProyect_ID:e};console.log("Payload de Gasto Externo:",T);console.log("PAYLOAD DE GASTO EXTERNO "+JSON.stringify(T,null,2));let m;if(o){m=await fetch(`/odata/v4/datos-cdo/GastoViajeRecExter(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{m=await fetch("/odata/v4/datos-cdo/GastoViajeRecExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(m.ok){const e=await m.json();const t=e.ID;this._idGastoRecuExter=t;await this.InsertMesA√±osGastoRecursoExterno(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: INSERTVIAJES RECURSO EXTERNO  ",e)}else{const e=await m.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}},insertarOtrosConceptos:async function(e){const t=this._sCsrfToken;const o=this._otrC;const a=this.byId("table0_1724413700665");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[2].getValue();const l=this.convertToInt(r.getCells()[3]?.getText());const c=parseInt(r.getCells()[4]?.getText()||"0",10);const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const f=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const g=this.convertToInt(r.getCells()[10]?.getText());const x=this.convertToInt(r.getCells()[11]?.getText());if(!n||!i||isNaN(l)||isNaN(g)||isNaN(x)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const y={Vertical_ID:n,ConceptoOferta:i,PMJ:l,year1:Number(c.toFixed(2)),year2:Number(d.toFixed(2)),year3:Number(u.toFixed(2)),year4:Number(h.toFixed(2)),year5:Number(f.toFixed(2)),year6:Number(p.toFixed(2)),total:g,totalC:x,datosProyect_ID:e};let T;try{if(o){T=await fetch(`/odata/v4/datos-cdo/otrosConceptos(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(y)})}else{T=await fetch("/odata/v4/datos-cdo/otrosConceptos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(y)})}if(T.ok){const e=await T.json();const t=e.ID;this._idOtrosConcep=t;await this.InsertMesA√±osOtrosConceptos(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: INSERTVIAJES RECURSO EXTERNO  ",e)}else{const e=await T.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertarLicencia:async function(e){const t=this._sCsrfToken;const o=this._idLinc;const a=this.byId("table0_1727955577124");const s=a.getItems();for(let a=0;a<s.length;a++){const r=s[a];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[2].getValue();const l=this.convertToInt(r.getCells()[3]?.getText());const c=parseInt(r.getCells()[5]?.getText()||"0",10);const d=parseInt(r.getCells()[6]?.getText()||"0",10);const u=parseInt(r.getCells()[7]?.getText()||"0",10);const h=parseInt(r.getCells()[8]?.getText()||"0",10);const f=parseInt(r.getCells()[9]?.getText()||"0",10);const p=parseInt(r.getCells()[10]?.getText()||"0",10);const g=this.convertToInt(r.getCells()[4]?.getText());const x=this.convertToInt(r.getCells()[5]?.getText());if(!n||!i||isNaN(l)||isNaN(g)||isNaN(x)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const y={Vertical_ID:n,ConceptoOferta:i,PMJ:l,year1:Number(c.toFixed(2)),year2:Number(d.toFixed(2)),year3:Number(u.toFixed(2)),year4:Number(h.toFixed(2)),year5:Number(f.toFixed(2)),year6:Number(p.toFixed(2)),total:g,totalC:x,datosProyect_ID:e};let T;try{if(o){T=await fetch(`/odata/v4/datos-cdo/LicenciasCon(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(y)})}else{T=await fetch("/odata/v4/datos-cdo/LicenciasCon",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(y)})}if(T.ok){const e=await T.json();const t=e.ID;this._idLicencia=t;await this.InsertMesA√±osLicencia(r,t);console.log("Fila "+(a+1)+" guardada con √©xito: INSERTAR LICENCIA ",e)}else{const e=await T.text();console.error("Error al guardar la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},convertToInt:function(e){const t=parseInt(e,10);return isNaN(t)?null:t},insertClientFactura:async function(e){const t=this._sCsrfToken;var o=this.byId("table_clienteFac");var a=o.getItems();var s=[];var r=0;a.forEach(function(t,o){if(o===a.length-1){return}var r=t.getCells();var n=r[0]?r[0].getMetadata().getName()==="sap.m.Input"?r[0].getValue():r[0].getText():"";var i=r[1]?r[1].getMetadata().getName()==="sap.m.Input"?r[1].getValue():r[1].getText():"";var l=this.byId("text73_172746565340567").getText();if(n!==""||i!==""){s.push({juridica:n,oferta:i,total:l,datosProyect_ID:e})}}.bind(this));console.log("Total de la columna oferta: ",r);try{const o=await fetch(`/odata/v4/datos-cdo/ClientFactura?$filter=datosProyect_ID eq '${e}'`,{method:"GET",headers:{Accept:"application/json","x-csrf-token":t}});if(!o.ok){throw new Error("Error al verificar existencia de las Facturas")}const a=await o.json();const r=a.value||[];for(let e of s){let o=r.find(t=>t.juridica===e.juridica);if(o){const a=await fetch(`/odata/v4/datos-cdo/ClientFactura(${o.ID})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(e)});if(a.ok){console.log(`Factura con ID ${o.ID} actualizada con √©xito:`,await a.json())}else{console.log("Error al actualizar la Factura:",await a.text());sap.m.MessageToast.show("Error al actualizar la Factura.")}}else{const o=await fetch("/odata/v4/datos-cdo/ClientFactura",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(e)});if(o.ok){console.log("Factura guardada con √©xito:",await o.json())}else{console.log("Error al guardar la Factura:",await o.text());sap.m.MessageToast.show("Error al guardar la Factura.")}}}}catch(e){console.error("Error en la operaci√≥n:",e);sap.m.MessageToast.show("Ocurri√≥ un error en la operaci√≥n.")}sap.m.MessageToast.show("El total de la columna oferta es: "+r)},metodoSumar:function(){var e=this.byId("table_clienteFac");var t=e.getItems();var o=0;console.log("Cantidad de filas en la tabla:",t.length);t.forEach(function(e,a){if(a<t.length-1){var s=e.getCells();var r="";var n=s[1];if(n.getMetadata().getName()==="sap.m.Input"){r=n.getValue()}r=r.trim();var i=parseFloat(r);console.log("Fila:",a,"Valor de la celda:",r,"-> Valor num√©rico:",i);if(!isNaN(i)){o+=i;console.log("Total acumulado hasta ahora:",o)}}});this.byId("text73_172746565340567").setText(o.toFixed(2)+"%");console.log("Total de la columna oferta:",o);this._totalOferta=o},metodoSumarFac:function(){var e=this.byId("table0");var t=e.getItems();var o=0;console.log("Cantidad de filas en la tabla:",t.length);t.forEach(function(e,a){if(a<t.length-1){var s=e.getCells();var r="";var n=s[2];if(n.getMetadata().getName()==="sap.m.Input"){r=n.getValue()}r=r.trim();var i=parseFloat(r);console.log("Fila:",a,"Valor de la celda:",r,"-> Valor num√©rico:",i);if(!isNaN(i)){o+=i;console.log("Total acumulado hasta ahora:",o)}}});this.byId("text73_172746565340569997").setText(o.toFixed(2));console.log("Total de la columna oferta:",o)},formatDuration:function(e){const t=Math.floor(e);const o=Math.floor((e-t)*60);const a=0;return`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(a).padStart(2,"0")}`},onClearFields:function(){var e=this.getView();function t(e){if(e instanceof sap.m.Input){e.setValue("")}else if(e instanceof sap.m.Select||e instanceof sap.m.ComboBox){e.setSelectedKey("")}else if(e instanceof sap.m.DatePicker){e.setDateValue(null)}else if(e instanceof sap.m.TextArea){e.setValue("")}else if(e instanceof sap.m.CheckBox){e.setSelected(false)}if(e.getAggregation){const o=e.getMetadata().getAllAggregations();for(let a in o){const o=e.getAggregation(a);if(Array.isArray(o)){o.forEach(t)}else if(o instanceof sap.ui.core.Control){t(o)}}}}e.findAggregatedObjects(false,t)},onSelectIniMethod:function(e){this.onInputChange(e);this.onSelectOpx(e)},onselectmethodsetinfo:function(e){this.onInputChange(e);this.fechasDinamicas(e);this.CaseAno()},CaseAno:function(e){var t=this.getView().byId("date_inico");var o=this.getView().byId("date_fin");var a=t.getDateValue();var s=o.getDateValue();if(a&&s){var r=a.getFullYear();var n=s.getFullYear();if(r>n){sap.m.MessageToast.show("La fecha de inicio no puede ser mayor que la fecha de fin.");return}var i=[];for(var l=r;l<=n;l++){i.push(l)}var c=this.calcularDistribucionInput();if(!c||Object.keys(c).length===0){return}var d=this;var u=0;var h={};var f={};var p={};i.forEach(e=>{h[e]=0;f[e]={}});Object.keys(c).forEach(function(e){i.forEach(function(t){if(c[e]&&c[e][t]){c[e][t].forEach(e=>{var o=e.elemento;var a=parseFloat(e.valor)||0;h[t]+=a;u+=a;if(!f[t][o]){f[t][o]=0}f[t][o]+=a;if(!p[o]){p[o]=0}p[o]+=a})}})});i.forEach(e=>{switch(e){case 2025:d.getView().byId("tipoS2025").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteT2025").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("cellCostesTotales_1_1").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TRecurso2025").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteD2025").setText((f[e]["Input2"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("costes_indirectos2025").setText((f[e]["Input3"]||0).toFixed(2)+"‚Ç¨");break;case 2026:d.getView().byId("tipoS2026").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TRecurso2026").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteT2026").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("cellCostesTotales_1_2").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteD2026").setText((f[e]["Input2"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("costes_indirectos2026").setText((f[e]["Input3"]||0).toFixed(2)+"‚Ç¨");break;case 2027:d.getView().byId("tipoS2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TRecurso2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteT2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteD2027").setText((f[e]["Input2"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("costes_indirectos2027").setText((f[e]["Input3"]||0).toFixed(2)+"‚Ç¨");break;case 2028:d.getView().byId("tipoS2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TRecurso2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");break;case 2029:d.getView().byId("tipoS2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TRecurso2027").setText((f[e]["Input1"]||0).toFixed(2)+"‚Ç¨");break}});d.getView().byId("tipoSTotal").setText((p["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TRecursoTotal").setText((p["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteTotalD").setText((p["Input2"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("TSCosteTotal").setText((p["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("cellCostesTotales_1_7").setText((p["Input1"]||0).toFixed(2)+"‚Ç¨");d.getView().byId("costes_indirectosTotal").setText((p["Input3"]||0).toFixed(2)+"‚Ç¨")}else{sap.m.MessageToast.show("Por favor, seleccione ambas fechas.")}},onAddRowPress:function(e){console.log(e);var t=this.byId(e);if(t){var o=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Select({selectedKey:"{TipoServicio>valueTipoServ}",forceSelection:false,items:{path:"/TipoServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreTipoServ}"})}}),new sap.m.Select({selectedKey:"{PerfilServicio>valuePerfil}",forceSelection:false,items:{path:"/PerfilServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombrePerfil}"})},change:this.updateRowData.bind(this)}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(o);this.fechasDinamicas();var a={getSource:()=>o};this.updateRowData(a)}else{console.error("No se encontr√≥ la tabla con ID: "+e)}},onAddRowPress2:function(e){var t=this.byId(e);if(!t){t=sap.ui.getCore().byId("container-project1---view--tablaConsuExter")}if(t){var o=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Select({selectedKey:"{TipoServicio>valueTipoServ}",forceSelection:false,items:{path:"/TipoServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreTipoServ}"})}}),new sap.m.Select({selectedKey:"{PerfilConsumo>valuePerfilC}",forceSelection:false,items:{path:"/PerfilConsumo",template:new sap.ui.core.Item({key:"{ID}",text:"{nombrePerfilC}"})},change:this.selectFuncionchange.bind(this)}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(o);this.fechasDinamicas();var a={getSource:()=>o};this.selectFuncionchange(a)}else{console.error("No se encontr√≥ la tabla con ID: "+e)}},onAddRowPress4:function(e){console.log(e);var t=this.byId("table0_1724413700665");if(t){var o=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Text({text:""}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(o);this.fechasDinamicas()}else{console.error("No se encontr√≥ la tabla con ID: "+e)}},onAddRowPress3:function(e){console.log(e);var t=this.byId("tablaRecExterno");if(t){var o=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Select({selectedKey:"{TipoServicio>valueTipoServ}",forceSelection:false,items:{path:"/TipoServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreTipoServ}"})}}),new sap.m.Input({value:""}),new sap.m.Input({value:""}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(o);this.fechasDinamicas()}else{console.error("No se encontr√≥ la tabla con ID: "+e)}},onDateChange:function(){this.updateVizFrame()},fechasDinamicas:function(e,t){var o=this.getView().byId("date_inico");var a=this.getView().byId("date_fin");if(!o||!a){console.error("Error: No se pudieron obtener los DatePickers.");return}var s=o.getDateValue();var r=a.getDateValue();if(!s||!r){return}var n=this.getMonthsDifference(s,r);var i=["box0_1714747137718","box0_1727879568594","box0_1727879817594","box0_1721815443829","box0_1727948724833","box0_1727950351451","box0_17218154429","box0_1727953252765","box1_1727953468615","box0_17254429","box0_1727955568380"];i.forEach(e=>{var t=this.getView().byId(e);if(t){t.setWidth(n>3?"3000px":"100%")}});var l=["tablaConsuExter","table_dimicFecha","tablaRecExterno","idOtroserConsu","idGastoViajeConsu","idServiExterno","idGastoRecuExter","table0_1724413700665","table0_1727955577124","table0_1727879576857","table0_1727879940116"];l.forEach(e=>{var t=this.getView().byId(e);if(!t){console.error("Error: No se pudo obtener la tabla con ID "+e);return}var o=t.getColumns().length;for(var a=o-1;a>=0;a--){var r=t.getColumns()[a].getHeader();if(r&&/\d{4}-\w+/.test(r.getText())){t.removeColumn(t.getColumns()[a])}}var i=this.findTotalColumnIndex(t);for(var l=0;l<=n;l++){var c=new Date(s.getFullYear(),s.getMonth()+l,1);var d=c.getFullYear();var u=c.toLocaleString("default",{month:"long"});var h=d+"-"+u;var f=new sap.m.Column({header:new sap.m.Label({text:h}),width:"100px"});t.insertColumn(f,i+1+l);for(var p=0;p<t.getItems().length;p++){var g=t.getItems()[p];var x=new sap.m.Input({placeholder:"0.00",change:this.handleInputChange.bind(this,e,p,l,d)});g.addCell(x)}}var y=this.getView().byId("scroll_container_"+e);if(y){y.setHorizontal(true);y.setVertical(false);y.setWidth("100%")}})},resetTableAccumulations:function(e){if(!this._yearlySums[e]){this._yearlySums[e]={}}if(!this._yearlySums[e][this.currentRow]){this._yearlySums[e][this.currentRow]={}}},handleInputChange:function(e,t,o,a,s){var r=parseFloat(s.getParameter("value"))||0;if(this.currentTable!==e){this.resetTableAccumulations(e);this.currentTable=e}if(!this._tableValues)this._tableValues={};if(!this._tableValues[e])this._tableValues[e]={};if(!this._tableValues[e][t])this._tableValues[e][t]={};var n=this._tableValues[e][t][o]||0;this._tableValues[e][t][o]=r;if(!this._editedRows)this._editedRows={};if(!this._editedRows[e])this._editedRows[e]=new Set;this._editedRows[e].add(t);this._tableChanged=true;if(!this._yearlySums[t])this._yearlySums[t]={};if(this._yearlySums[t][a]!==undefined){this._yearlySums[t][a]-=n}this._yearlySums[t][a]=(this._yearlySums[t][a]||0)+r;if(!this._yearlySums[e])this._yearlySums[e]={};if(!this._yearlySums[e][t])this._yearlySums[e][t]={};if(!this._yearlySums[e][t][a])this._yearlySums[e][t][a]=0;this._yearlySums[e][t][a]-=n;this._yearlySums[e][t][a]+=r;this.updateTotalField(e,t,r);if(!this._insercionesPorAnoYTabla)this._insercionesPorAnoYTabla={};if(!this._insercionesPorAnoYTabla[a])this._insercionesPorAnoYTabla[a]={};if(!this._insercionesPorAnoYTabla[a][e])this._insercionesPorAnoYTabla[a][e]=0;this._insercionesPorAnoYTabla[a][e]++;if(!this._insercionesPorTabla)this._insercionesPorTabla={};if(!this._insercionesPorTabla[e])this._insercionesPorTabla[e]=0;this._insercionesPorTabla[e]++;this.calcularPorcentajeInserciones();this.CaseAno(e)},calcularPorcentajeInserciones:function(){let e=0;for(let t in this._insercionesPorTabla){e+=this._insercionesPorTabla[t]}if(e===0){console.log(" No hay inserciones registradas.");return}this._porcentajesPorTabla={};for(let t in this._insercionesPorTabla){let o=this._insercionesPorTabla[t]/e*100;this._porcentajesPorTabla[t]=o}if(this._insercionesPorAnoYTabla){for(let t in this._insercionesPorAnoYTabla){for(let o in this._insercionesPorAnoYTabla[t]){const a=this._insercionesPorAnoYTabla[t][o]||0;let s=a/e*100}}}},calcularDistribucionInput:function(){let e=[{id:"input0_1725625161348",nombre:"Input1",tipo:"input"},{id:"totalSubtotal",nombre:"Input2",tipo:"input"},{id:"input2_1724756105",nombre:"Input3",tipo:"input"},{id:"text33",nombre:"Text1",tipo:"text",tabla:"table_dimicFecha"},{id:"text32_1723542481599",nombre:"Text2",tipo:"text",tabla:"table_dimicFecha"},{id:"text560",nombre:"Text3",tipo:"text",tabla:"tablaConsuExter"}];let t={};e.forEach(e=>{let o=this.byId(e.id);if(!o){console.error(`Error: No se encontr√≥ el elemento con ID '${e.id}'`);return}let a=e.tipo==="input"?parseFloat(o.getValue())||0:parseFloat(o.getText())||0;if(a===0){return}for(let o in this._porcentajesPorTabla){if(e.tipo==="text"&&o!==e.tabla){continue}let s=this._porcentajesPorTabla[o];let r=a*s/100;if(!t[o]){t[o]={}}for(let a in this._insercionesPorAnoYTabla){if(!this._insercionesPorAnoYTabla[a][o]){continue}let s=this._insercionesPorAnoYTabla[a][o];if(!this._insercionesPorTabla[o]||this._insercionesPorTabla[o]===0){continue}if(!t[o][a]){t[o][a]=[]}if(e.tipo==="text"){let s=this._insercionesPorAnoYTabla[a][o]||1;let n=r/s;let i=100/s;let l=0;let c=[];for(let t=0;t<s;t++){let o=t===s-1?r-l:n;l+=o;c.push({elemento:e.nombre,porcentaje:i.toFixed(2),valor:o.toFixed(2)})}t[o][a].push(...c)}else{let n=s/this._insercionesPorTabla[o]*100;let i=r*n/100;t[o][a].push({elemento:e.nombre,porcentaje:n.toFixed(2),valor:i.toFixed(2)})}}}});console.log("Distribuci√≥n final de valores:",t);return t},updateTotalField:function(e,t,o,a,s){var r=0;var n=0;var i=0;var l=0;var c=0;let d=0;var u,h,f;var p=this.getTotalForYear(2025,t,e);var g=this.getTotalForYear(2026,t,e);var x=this.getTotalForYear(2027,t,e);var y=this.getTotalForYear(2028,t,e);var T=this.getTotalForYear(2029,t,e);var m=this.getTotalForYear(2030,t,e);if(e==="tablaConsuExter"){var v=this.byId("tablaConsuExter");if(!v){console.error(" 2. La tabla 'tablaConsuExter' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){r=o[4].getText();o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");n=p+g+x+y+T+m;var a=r*n;o[11].setText(n.toFixed(2)+"‚Ç¨");o[12].setText(a+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="table_dimicFecha"){var v=this.byId("table_dimicFecha");if(!v){console.error("3. La tabla 'table_dimicFecha' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){var a=o[4].getText();o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");i=p+g+x+y+T+m;var s=a*i;o[11].setText(i.toFixed(2));o[12].setText(s+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="tablaRecExterno"){var v=this.byId("tablaRecExterno");if(!v){console.error("4. La tabla 'tablaRecExterno' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){var a=o[4].getValue();o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");l=p+g+x+y+T+m;o[11].setText(l.toFixed(2)+"‚Ç¨");var s=a*l;o[12].setText(s+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="idOtroserConsu"){var v=this.byId("idOtroserConsu");if(!v){console.error("La tabla 'idOtroserConsu' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[11].setText(a.toFixed(2)+"‚Ç¨");o[12].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="idGastoViajeConsu"){var v=this.byId("idGastoViajeConsu");if(!v){console.error("La tabla 'idGastoViajeConsu' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[11].setText(a.toFixed(2)+"‚Ç¨");o[12].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="idServiExterno"){var v=this.byId("idServiExterno");if(!v){console.error("La tabla 'idServiExterno' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[11].setText(a.toFixed(2)+"‚Ç¨");o[12].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="idGastoRecuExter"){var v=this.byId("idGastoRecuExter");if(!v){console.error("La tabla 'idGastoRecuExter' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[11].setText(a.toFixed(2)+"‚Ç¨");o[12].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="table0_1724413700665"){var v=this.byId("table0_1724413700665");if(!v){console.error("La tabla 'table0_1724413700665' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[4].setText(p.toFixed(2)+"‚Ç¨");o[5].setText(g.toFixed(2)+"‚Ç¨");o[6].setText(x.toFixed(2)+"‚Ç¨");o[7].setText(y.toFixed(2)+"‚Ç¨");o[8].setText(T.toFixed(2)+"‚Ç¨");o[9].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[10].setText(a.toFixed(2)+"‚Ç¨");o[11].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="table0_1727955577124"){var v=this.byId("table0_1727955577124");if(!v){console.error("La tabla 'table0_1727955577124' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=12){o[4].setText(p.toFixed(2)+"‚Ç¨");o[5].setText(g.toFixed(2)+"‚Ç¨");o[6].setText(x.toFixed(2)+"‚Ç¨");o[7].setText(y.toFixed(2)+"‚Ç¨");o[8].setText(T.toFixed(2)+"‚Ç¨");o[9].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[10].setText(a.toFixed(2)+"‚Ç¨");o[11].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="table0_1727879576857"){var v=this.byId("table0_1727879576857");if(!v){console.error("La tabla 'table0_1727879576857' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[11].setText(a.toFixed(2)+"‚Ç¨");o[12].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else if(e==="table0_1727879940116"){var v=this.byId("table0_1727879940116");if(!v){console.error("La tabla 'table0_1727879940116' no fue encontrada.");return}console.log("tabla encontrada ",e);this._editedRows[e].forEach(function(e){var t=v.getItems()[e];if(t){var o=t.getCells();if(o&&o.length>=11){o[5].setText(p.toFixed(2)+"‚Ç¨");o[6].setText(g.toFixed(2)+"‚Ç¨");o[7].setText(x.toFixed(2)+"‚Ç¨");o[8].setText(y.toFixed(2)+"‚Ç¨");o[9].setText(T.toFixed(2)+"‚Ç¨");o[10].setText(m.toFixed(2)+"‚Ç¨");var a=p+g+x+y+T+m;o[11].setText(a.toFixed(2)+"‚Ç¨");o[12].setText(a.toFixed(2)+"‚Ç¨")}}});this.onSumarColumna(e)}else{console.error("Tabla no reconocida: "+e)}this._editedRows[e].clear()},getTotalForYear:function(e,t,o){if(Number(t)!==Number(this.currentRow)||o!==this.currentTableId){this.resetTableAccumulations(o);this.currentRow=Number(t);this.currentTableId=o}if(!this._yearlySums[o]){console.warn(`‚ö†Ô∏è No hay datos para la tabla ${o}. Creando estructura.`);this._yearlySums[o]={}}if(!this._yearlySums[o][t]){console.warn(`‚ö†Ô∏è No hay datos para la fila ${t} en la tabla ${o}. Creando estructura.`);this._yearlySums[o][t]={}}if(this._yearlySums[o][t][e]===undefined){this._yearlySums[o][t][e]=0}return this._yearlySums[o][t][e]},onSumarColumna:function(e){var t=this.byId(e);var o=t.getItems();var a=0;var s=0;var r=0;var n=0;var i=0;o.forEach(function(e){var t=e.getCells();var o=t.length>11&&t[11].getText?t[11].getText():"0";var l=t.length>12&&t[12].getText?t[12].getText():"0";a+=parseFloat(o)||0;s+=parseFloat(l)||0;r+=parseFloat(o)||0;n+=parseFloat(o)||0;i+=parseFloat(o)||0});if(e==="table_dimicFecha"){this.byId("inputReInter").setValue(a.toFixed(2));this.byId("inputServi1").setValue(s.toFixed(2)+"‚Ç¨")}else if(e==="table0_1727879576857"){this.byId("inputOtrosServi1").setValue(r.toFixed(2)+"‚Ç¨")}else if(e==="table0_1727879940116"){this.byId("inputGastoVia1").setValue(n.toFixed(2)+"‚Ç¨")}else if(e==="table0_1727955577124"){this.byId("input0_1724758359").setValue(r.toFixed(2)+"‚Ç¨")}else if(e==="tablaRecExterno"){this.byId("inputRcurExtern").setValue(a.toFixed(2)+"‚Ç¨");this.byId("inputServi").setValue(s.toFixed(2)+"‚Ç¨")}else if(e==="idServiExterno"){this.byId("input10_1724757017406").setValue(a.toFixed(2)+"‚Ç¨")}else if(e==="idGastoRecuExter"){this.byId("input9_1724757015442").setValue(a.toFixed(2)+"‚Ç¨")}else if(e==="tablaConsuExter"){this.byId("inputServi2").setValue(s.toFixed(2));this.byId("inputConsuEx").setValue(a.toFixed(2))}else if(e==="idOtroserConsu"){this.byId("inputOtroSer2").setValue(r.toFixed(2)+"‚Ç¨")}else if(e==="idGastoViajeConsu"){this.byId("inptGastoVi2").setValue(r.toFixed(2)+"‚Ç¨")}else if(e==="table0_1724413700665"){this.byId("totalInfraestruc").setValue(a.toFixed(2)+"‚Ç¨")}this.onColumnTotales();return a},onColumnTotales:function(){var e=0;var t=0;var o=0;var a=0;var s=0;var r=parseFloat(this.byId("inputReInter").getValue())||0;var n=parseFloat(this.byId("inputConsuEx").getValue())||0;var i=parseFloat(this.byId("inputRcurExtern").getValue())||0;e=r+n+i;this.byId("inputTotalJor").setValue(e.toFixed(2));var l=parseFloat(this.byId("inputServi1").getValue())||0;var c=parseFloat(this.byId("inputOtrosServi1").getValue())||0;var d=parseFloat(this.byId("inputGastoVia1").getValue())||0;t=l+c+d;this.byId("totalRecuInter").setValue(t.toFixed(2));var u=parseFloat(this.byId("inputServi2").getValue())||0;var h=parseFloat(this.byId("inputOtroSer2").getValue())||0;var f=parseFloat(this.byId("inptGastoVi2").getValue())||0;o=u+h+f;this.byId("totalConsuExternot").setValue(o.toFixed(2));var p=parseFloat(this.byId("inputServi").getValue())||0;var g=parseFloat(this.byId("input10_1724757017406").getValue())||0;var x=parseFloat(this.byId("input9_1724757015442").getValue())||0;a=p+g+x;this.byId("totaRecurExterno").setValue(a.toFixed(2));var y=parseFloat(this.byId("totalInfraestruc").getValue())||0;var T=parseFloat(this.byId("input0_1724758359").getValue())||0;s=t+o+a+y+T;var m=new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s);this.byId("totalSubtotal").setValue(m);var v=parseFloat(this.byId("input2_172475612").getValue())||0;var I=s*(v/100);this.byId("input2_1724756105").setValue(I.toFixed(2));var b=parseFloat(this.byId("input2_17221205").getValue())/100||0;var C=s+I;var w=C/(1-b)-C;this.byId("input2_1756121205").setValue(w.toFixed(2));var F=C+w;var E=new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(F);var S=E+" ‚Ç¨";this.byId("input0_1725625161348").setValue(S);this.CaseAno();if(this._insercionesPorAnoYTabla){this.CaseAno()}},findTotalColumnIndex:function(e){var t=e.getColumns();var o=t.length-1;for(var a=0;a<t.length;a++){var s=t[a].getHeader();if(s&&(s.getText()==="Total1"||s.getText()==="")){return a}}return o+1},getMonthsDifference:function(e,t){var o=(t.getFullYear()-e.getFullYear())*12;o-=e.getMonth();o+=t.getMonth();return o<0?0:o},onNavToView1:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("appNoparame")},onSelectOpx:function(e){var t=this.byId("slct_inic").getSelectedItem();var o=this.byId("idNatu");var a=t.getText();console.log("Valor seleccionado:",a);var s=this.getView().byId("table0");if(a==="Opex Servicios"){s.setVisible(true);this.byId("input2_172475612").setValue(parseFloat("0.00%".replace("%","")).toFixed(2));this.byId("text67_1728582763477").setText("Opex Servicios  - El Margen debe ser establecido al 0%")}else{s.setVisible(false);this.byId("input2_172475612").setValue(parseFloat("5.00%".replace("%","")).toFixed(2))}if(a==="Proyecto/Servicio a Cliente Externo"){this.byId("input2_17221205").setValue(parseFloat("20.00".replace(",",".")).toFixed(2));this.byId("text67_1728582763477").setText("Margen por defecto 20%, si es inferior al 14,29% la propuesta debe pasar por comit√©")}else if(a==="Proyecto/Servicio Interno PdV"){this.byId("input2_17221205").setValue(parseFloat("10.00".replace(",",".")).toFixed(2));this.byId("text67_1728582763477").setText("Margen por defecto 10%, si el Margen es inferior al 5% la propuesta debe pasar por comit√©")}else if(a==="Proyecto/Servicio de Inversion"){this.byId("input2_17221205").setValue(parseFloat("0.00".replace(",",".")).toFixed(2));this.byId("text67_1728582763477").setText("Proyecto/Servicio de Inversi√≥n - El Margen debe ser establecido al 0%")}else{this.byId("input2_17221205").setValue("")}},onCheckBoxSelectMulti:function(e){var t=e.getSource();var o=t.getSelected();var a=this.byId("table_clienteFac");if(a){a.setVisible(o)}},onInputChange:function(){var e=this.getView();var t=this.byId("input0").getValue();var o=this.byId("input1").getValue();var a=this.byId("id_Cfactur").getValue();var s=this.byId("int_clienteFun").getValue();var r=this.byId("slct_area");var n="";var i="";if(r&&r.getSelectedItem()){n=r.getSelectedItem().getText();i=r.getSelectedItem().getKey()}var l=this.byId("slct_Jefe");var c="";if(l&&l.getSelectedItem()){c=l.getSelectedItem().getText()}var d=this.byId("slct_client");var u="";if(d&&d.getSelectedItem()){u=d.getSelectedItem().getText()}var h=this.byId("date_inico");var f=h?h.getDateValue():null;var p="";if(f){p=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"}).format(f)}var g=this.byId("slct_inic");var x="";if(g&&g.getSelectedItem()){x=g.getSelectedItem().getText()}var y=this.byId("idNatu");var T="";if(y&&y.getSelectedItem()){T=y.getSelectedItem().getText()}var m=this.byId("date_fin");var v=m?m.getDateValue():null;var I="";if(v){I=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"}).format(v)}this.byId("txt_codig").setText(t);this.byId("txt_nomPro").setText(o);this.byId("txt_area").setText(n);this.byId("txt_NomJefe").setText(c);this.byId("txt_funcio").setText(s);this.byId("txt_feIni").setText(p);this.byId("txt_feFin").setText(I);this.byId("txt_ini").setText(x);this.byId("text72_1731325324246").setText(x);this.byId("text73_1731325328049").setText(T);this.byId("txt_client").setText(s);this.byId("txt_cFactura").setText(a);this.byId("txt_Codi2").setText(t);this.byId("txt_Nombre2").setText(o);this.byId("txt_area2").setText(n);this.byId("txt_Fe_ini2").setText(p);this.byId("txt_Fe_fin2").setText(I);this.byId("textClitFu3").setText(s);this.byId("textCliFac3").setText(a);this.byId("textCodigo3").setText(t);this.byId("textNatural3").setText(T);this.byId("txtNombre3").setText(o);this.byId("txtAre3").setText(n);this.byId("txtFechInici3").setText(p);this.byId("txtFechFin3").setText(I)},onSelectCheckbox:function(e){try{var t=this.byId("table2");if(!t){console.error("Tabla no encontrada.");return}var o=t.getItems();var a=e.getSource().getSelected();if(a===undefined){console.error("Error al obtener el estado del checkbox.");return}var s=e.getSource().getParent().getParent().indexOfColumn(e.getSource().getParent());var r=s===0?"box_prove":"box_condi";var n=this.byId(r);if(!n){console.error("El otro checkbox no se encontr√≥.");return}n.setEnabled(!a);o.forEach(function(e){var t=e.getCells();t.forEach(function(e,t){if(e.setEditable){e.setEditable(t===s?a:!a)}})})}catch(e){console.error("Error en la funci√≥n onSelectCheckbox:",e)}}})});
//# sourceMappingURL=View1.controller.js.map