sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/format/DateFormat","sap/viz/ui5/controls/VizFrame","sap/ui/model/odata/v4/ODataModel","sap/m/MessageToast","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/json/JSONModel"],function(e,t,a,o,s,r,n,i,l){"use strict";return e.extend("project1.controller.View1",{recursoID:null,onInit:function(){var e=new sap.ui.model.json.JSONModel({milestones:[{fase:"Kick off",fechaInicio:null,fechaFin:null},{fase:"Diseño",fechaInicio:null,fechaFin:null},{fase:"Construcción",fechaInicio:null,fechaFin:null},{fase:"Pruebas TQ",fechaInicio:null,fechaFin:null},{fase:"Go live",fechaInicio:null,fechaFin:null},{fase:"Paso AM",fechaInicio:null,fechaFin:null},{fase:"Server post/prod",fechaInicio:null,fechaFin:null}],chartData:[]});this.getView().setModel(e,"planning");var t=this.byId("idVizFrame");t.setVizProperties({title:{text:"Planificacion"}});this._tableValues={tablaConsuExter:{},table_dimicFecha:{},tablaRecExterno:{},idOtroserConsu:{},idGastoViajeConsu:{},idServiExterno:{},idGastoRecuExter:{},table0_1724413700665:{},table0_1727955577124:{},table0_1727879576857:{},table0_1727879940116:{}};this._editedRows=this._editedRows||{};this._rowYearlySums=this._rowYearlySums||{};this.currentRow=0;this.currentTable=0;var a=new sap.ui.model.json.JSONModel({fechas:[{fase:"Fechas Importantes",fechaInicioConstruccion:"2024-09-01",fechaFinPruebasTQ:"2024-09-30"}]});this.getView().setModel(a,"fechasModel");var o=this.byId("idVizFrame2");o.setVizProperties({title:{text:"Plan"}});this.updateVizFrame1();this.updateVizFrame3();var s=sap.ui.core.UIComponent.getRouterFor(this);s.getRoute("view").attachPatternMatched(this._onObjectMatched,this);this.updateVizFrame2();this._yearlySums={2024:0,2025:0,2026:0,2027:0,2028:0,2029:0};this.token()},highlightControls:function(){console.log("Se cambiaron las pestañas debido a campos vacíos.");const e=[this.byId("input0"),this.byId("input1"),this.byId("int_clienteFun"),this.byId("id_Cfactur"),this.byId("id_Cfactur"),this.byId("idObje"),this.byId("idAsunyRestri"),this.byId("box_multiJuridica"),this.byId("box_pluriAnual"),this.byId("slct_area"),this.byId("slct_Jefe"),this.byId("slct_verti"),this.byId("slct_inic"),this.byId("idNatu"),this.byId("selct_Amrecp"),this.byId("selc_ejcu"),this.byId("selc_Segui"),this.byId("slct_client"),this.byId("date_inico"),this.byId("date_fin"),this.byId("input0"),this.byId("input1"),this.byId("box_pluriAnual"),this.byId("id_Cfactur"),this.byId("box_multiJuridica")];e.forEach(e=>{if(e&&e.setValueState){e.setValueState("Success")}});setTimeout(()=>{e.forEach(e=>{if(e&&e.setValueState){e.setValueState("None")}})},2e3)},_onObjectMatched:async function(e){var t=this.getView().getModel("mainService");if(t){t.setData({});t.refresh(true)}var a=e.getParameter("arguments").sProjectID;this._sProjectID=a;var o=`./odata/v4/datos-cdo/DatosProyect(${a})`;try{const e=await fetch(o,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","x-csrf-token":"fetch"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const t=await e.json();console.log("Datos del proyecto:",t);if(t){this.byId("input0").setValue(t.codigoProyect||"");this.byId("input1").setValue(t.nameProyect||"");this.byId("int_clienteFun").setValue(t.funcionalString||"");this.byId("id_Cfactur").setValue(t.clienteFacturacion||"");this.byId("idObje").setValue(t.objetivoAlcance||"");this.byId("idAsunyRestri").setValue(t.AsuncionesyRestricciones||"");this.byId("box_multiJuridica").setSelected(!!t.multijuridica);this.byId("box_pluriAnual").setSelected(!!t.pluriAnual);this.byId("slct_area").setSelectedKey(t.Area_ID||"");this.byId("slct_Jefe").setSelectedKey(t.jefeProyectID_ID||"");this.byId("slct_verti").setSelectedKey(t.Vertical_ID||"");this.byId("slct_inic").setSelectedKey(t.Iniciativa_ID||"");this.byId("idNatu").setSelectedKey(t.Naturaleza_ID||"");this.byId("selct_Amrecp").setSelectedKey(t.AmReceptor_ID||"");this.byId("selc_ejcu").setSelectedKey(t.EjecucionVia_ID||"");this.byId("selc_Segui").setSelectedKey(t.Seguimiento_ID||"");this.byId("slct_client").setSelectedKey(t.clienteFuncional_ID||"");this.byId("date_inico").setDateValue(t.Fechainicio?new Date(t.Fechainicio):null);this.byId("date_fin").setDateValue(t.FechaFin?new Date(t.FechaFin):null);this.byId("input0").setValue(t.codigoProyect);this.byId("input1").setValue(t.nameProyect);this.byId("box_pluriAnual").setSelected(t.pluriAnual);this.byId("id_Cfactur").setValue(t.clienteFacturacion);this.byId("box_multiJuridica").setSelected(t.multijuridica);await this.fetchMilestones(a);await this.leerProveedor(a);await this.leerFacturacion(a);await this.leerClientFactura(a);await this.leerRecursos(a);await this.leerConsumoExterno(a);await this.leerRecursoExterno(a);await this.leerOtrosConcepto(a);const e=this.byId("564433");e.setText("Guardar");sap.m.MessageToast.show("Datos cargados correctamente")}}catch(e){console.error("Error al obtener los datos del proyecto:",e);sap.m.MessageToast.show("Error al cargar los datos del proyecto")}this.highlightControls()},fetchMilestones:async function(e){if(!e){console.error("Error: projectID es inválido o indefinido:",e);sap.m.MessageToast.show("Error: ID del proyecto no válido.");return}var t=`/odata/v4/datos-cdo/planificacion?$filter=datosProyect_ID eq ${e}`;try{const r=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!r.ok){const e=await r.text();throw new Error("Error en la respuesta de la API: "+e)}const n=await r.json();console.log("Datos de planificación recibidos:",n);if(!n||!n.value||!Array.isArray(n.value)||n.value.length===0){console.warn("No se encontraron datos de planificación para el proyecto:",e);sap.m.MessageToast.show("No hay datos de planificación disponibles.");return}var a=n.value[0];if(!a||!a.ID){console.warn("El primer recurso no tiene un ID válido.");sap.m.MessageToast.show("Error en los datos recibidos.");return}var o=a.ID;n.value.sort((e,t)=>new Date(e.fecha_inicio)-new Date(t.fecha_inicio));var s=this.getView().getModel("planning");n.value.forEach((e,t)=>{var a="/milestones/"+t;var o=e.fecha_inicio?new Date(e.fecha_inicio).toISOString().split("T")[0]:null;var r=e.fecha_fin?new Date(e.fecha_fin).toISOString().split("T")[0]:null;s.setProperty(a+"/fechaInicio",o);s.setProperty(a+"/fechaFin",r)});this._idPlani=o;this.updateVizFrame1(n);console.log("ID de planificación recuperado:",this._idPlani)}catch(e){console.error("Error al obtener los datos de planificación:",e);sap.m.MessageToast.show("Error al cargar los datos de planificación.")}},leerProveedor:async function(e){var t=`/odata/v4/datos-cdo/ProveedoresC?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const n=await e.json();console.log("Datos de proveedor:",n);var a=this.byId("table2");var o=a.getItems();if(n.value&&n.value.length>0){var s=n.value[0];var r=s.ID;o.forEach(function(e){var t=e.getCells();if(t.length>1){t[0].setValue(s.valueCondi||"");t[1].setValue(s.valueProvee||"")}this.byId("box_condi").setSelected(s.checkCondi||false);this.byId("box_prove").setSelected(s.checkProveedor||false)}.bind(this));this._proveeID=r}else{console.log("No hay datos de proveedores disponibles.")}}catch(e){console.error("Error al obtener los datos de proveedor:",e);sap.m.MessageToast.show("Error al cargar los datos de proveedor")}},leerFacturacion:async function(e){var t=`/odata/v4/datos-cdo/Facturacion?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const r=await e.json();console.log("Datos de Facturacion :",r);var a=this.byId("table0");var o=a.getItems();if(r.value&&r.value.length>0){var s=r.value[0];console.log("Valor de fecha estimada:",s.fechaEstimida);o.forEach(function(e){var t=e.getCells();if(t.length>1){if(t[0]instanceof sap.m.DatePicker){console.log("Tipo de celda:",t[0].constructor.name);t[0].setDateValue(s.fechaEstimida?new Date(s.fechaEstimida):null)}if(t[1]instanceof sap.m.Input){t[1].setValue(s.descripcionHito||"")}if(t[2]instanceof sap.m.Input){t[2].setValue(s.facturacion||"")}}}.bind(this))}else{console.log("No hay datos de Facturacion disponibles.")}}catch(e){console.error("Error al obtener los datos de Facturacion:",e);sap.m.MessageToast.show("Error al cargar los datos de Facturacion")}},leerClientFactura:async function(e){var t=`/odata/v4/datos-cdo/ClientFactura?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const d=await e.json();console.log("Datos de Cliente factura:",d);var a=this.byId("table_clienteFac");var o=a.getItems();if(d.value&&d.value.length>0){for(let e=0;e<Math.min(o.length,d.value.length);e++){var s=o[e];var r=s.getCells();var n=d.value[e];if(r[0].getMetadata().getName()==="sap.m.Input"){r[0].setValue(n.juridica||"")}else if(r[0].getMetadata().getName()==="sap.m.Text"){r[0].setText(n.juridica||"")}if(r[1].getMetadata().getName()==="sap.m.Input"){r[1].setValue(n.oferta||"")}else if(r[1].getMetadata().getName()==="sap.m.Text"){r[1].setText(n.oferta||"")}var i=this.byId("text73_172746565340567");if(i.getMetadata().getName()==="sap.m.Input"){i.setValue(n.oferta||"")}else if(i.getMetadata().getName()==="sap.m.Text"){i.setText(n.oferta||"")}}}else{console.log("No hay datos de cliente factura disponibles.")}var l=this.byId("box_multiJuridica");var c=l.getSelected();this.onCheckBoxSelectMulti({getSource:()=>l,getSelected:()=>c})}catch(e){console.error("Error al obtener los datos de cliente Facturacion:",e);sap.m.MessageToast.show("Error al cargar los datos de cliente Facturacion")}},leerRecursos:async function(e){var t=`/odata/v4/datos-cdo/RecursosInternos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS RECURSOS TRAIDO:",l);var a=this.byId("table_dimicFecha");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;console.log("ID del recurso:",r);if(o.length>0){var n=o[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[2].setSelectedKey(s.PerfilServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalE?parseFloat(s.totalE).toFixed(2):"0.00")}}await this.leerFechas(r);await this.leerOtServRe(r);await this.leerOtrosGastoVRecu(r);this._recurso_ID=r}else{console.log("No hay datos de SERvi Recurso  internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerFechas:async function(e){var t=`/odata/v4/datos-cdo/ValorMensuReInter?$filter=RecursosInternos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const s=await e.json();var a=s.value[0];var o=a.ID;console.log("Datos de DATOS MESAÑO TRAIDO: -----\x3e ",s)}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerOtServRe:async function(e){var t=`/odata/v4/datos-cdo/otrosGastoRecu?$filter=RecursosInternos_ID eq ${e}`;try{const n=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!n.ok){const e=await n.text();throw new Error("Network response was not ok: "+e)}const i=await n.json();console.log("Datos de DATOS otrosRecursosSErvi TRAIDO: -----\x3e ",i);var a=this.byId("table0_1727879576857");var o=a.getItems();if(i.value&&i.value.length>0){if(o.length>0){var s=o[0];var r=s.getCells();if(r.length>1){r[0].setSelectedKey(Recurso.Vertical_ID||"");r[1].setSelectedKey(Recurso.tipoServicio_ID||"");r[3].setValue(Recurso.ConceptoOferta||"");r[4].setText(Recurso.PMJ?parseFloat(Recurso.PMJ).toFixed(2):"0.00");r[5].setText(Recurso.year1?parseFloat(Recurso.year1).toFixed(2):"0.00");r[6].setText(Recurso.year2?parseFloat(Recurso.year2).toFixed(2):"0.00");r[7].setText(Recurso.year3?parseFloat(Recurso.year3).toFixed(2):"0.00");r[8].setText(Recurso.year4?parseFloat(Recurso.year4).toFixed(2):"0.00");r[9].setText(Recurso.year5?parseFloat(Recurso.year5).toFixed(2):"0.00");r[10].setText(Recurso.year6?parseFloat(Recurso.year6).toFixed(2):"0.00");r[11].setText(Recurso.total?parseFloat(Recurso.total).toFixed(2):"0.00");r[12].setText(Recurso.totalE?parseFloat(Recurso.totalE).toFixed(2):"0.00")}}this._RecuOtrse=e}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerOtrosGastoVRecu:async function(e){var t=`/odata/v4/datos-cdo/otrosRecursos?$filter=RecursosInternos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const i=await e.json();console.log("Datos de DATOS otrosGastoRecu TRAIDO: -----\x3e ",i);var a=this.byId("table0_1727879940116");var o=a.getItems();if(i.value&&i.value.length>0){var s=i.value[0];if(o.length>0){var r=o[0];var n=r.getCells();if(n.length>1){n[0].setSelectedKey(s.Vertical_ID||"");n[1].setSelectedKey(s.tipoServicio_ID||"");n[3].setValue(s.ConceptoOferta||"");n[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");n[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");n[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");n[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");n[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");n[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");n[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");n[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");n[12].setText(s.totalE?parseFloat(s.totalE).toFixed(2):"0.00")}}}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerConsumoExterno:async function(e){var t=`/odata/v4/datos-cdo/ConsumoExternos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS ConsumoExternos TRAIDO:",l);var a=this.byId("tablaConsuExter");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(o.length>0){var n=o[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[2].setSelectedKey(s.PerfilServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerConsuOtroServi(r);await this.leerGastoViajeConsu(r);this._idConsum=r;console.log("LEER CONSUMO ID   "+r)}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerConsuOtroServi:async function(e){var t=`/odata/v4/datos-cdo/otrosServiciosConsu?$filter=ConsumoExternos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS otrosServiciosConsu TRAIDO:",l);var a=this.byId("idOtroserConsu");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(o.length>0){var n=o[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idConOS=r}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerGastoViajeConsu:async function(e){var t=`/odata/v4/datos-cdo/GastoViajeConsumo?$filter=ConsumoExternos_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos de DATOS idGastoViajeConsu TRAIDO:",l);var a=this.byId("idGastoViajeConsu");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(o.length>0){var n=o[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}this._idCviajO=r}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerRecursoExterno:async function(e){var t=`/odata/v4/datos-cdo/RecursosExternos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos traidos RecursosExternos TRAIDO:",l);var a=this.byId("tablaRecExterno");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(o.length>0){var n=o[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[1].setSelectedKey(s.tipoServicio_ID||"");i[2].setSelectedKey(s.PerfilServicio_ID||"");i[3].setValue(s.ConceptoOferta||"");i[4].setValue(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerOtrosServiExter(r);await this.leerGastoViaExter(r);this._idRecEx=r}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerOtrosServiExter:async function(e){var t=`/odata/v4/datos-cdo/serviRecurExter?$filter=RecursosExternos_ID eq ${e}`;try{const i=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!i.ok){const e=await i.text();throw new Error("Network response was not ok: "+e)}const l=await i.json();console.log("Datos traidos serviRecurExter TRAIDO:",l);var a=this.byId("idServiExterno");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var e=s.ID;if(o.length>0){var r=o[0];var n=r.getCells();if(n.length>1){n[0].setSelectedKey(s.Vertical_ID||"");n[1].setSelectedKey(s.tipoServicio_ID||"");n[3].setValue(s.ConceptoOferta||"");n[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");n[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");n[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");n[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");n[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");n[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");n[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");n[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");n[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerOtrosServiExter(e)}else{console.log("No hay datos de servi Externos  disponibles.")}}catch(e){console.error("Error al obtener los datos de serviRecurExter:",e);sap.m.MessageToast.show("Error al cargar los datos de serviRecurExter")}},leerGastoViaExter:async function(e){var t=`/odata/v4/datos-cdo/GastoViajeRecExter?$filter=RecursosExternos_ID eq ${e}`;try{const i=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!i.ok){const e=await i.text();throw new Error("Network response was not ok: "+e)}const l=await i.json();console.log("Datos traidos GastoViajeRecExter TRAIDO:",l);var a=this.byId("idGastoRecuExter");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var e=s.ID;if(o.length>0){var r=o[0];var n=r.getCells();if(n.length>1){n[0].setSelectedKey(s.Vertical_ID||"");n[1].setSelectedKey(s.tipoServicio_ID||"");n[3].setValue(s.ConceptoOferta||"");n[4].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");n[5].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");n[6].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");n[7].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");n[8].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");n[9].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");n[10].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");n[11].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");n[12].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerOtrosServiExter(e)}else{console.log("No hay datos de GastoViajeRecExter  disponibles.")}}catch(e){console.error("Error al obtener los datos de GastoViajeRecExter:",e);sap.m.MessageToast.show("Error al cargar los datos de GastoViajeRecExter")}},leerOtrosConcepto:async function(e){var t=`/odata/v4/datos-cdo/otrosConceptos?$filter=datosProyect_ID eq ${e}`;try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok){const t=await e.text();throw new Error("Network response was not ok: "+t)}const l=await e.json();console.log("Datos traidos otrosConceptos TRAIDO:",l);var a=this.byId("table0_1724413700665");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var r=s.ID;if(o.length>0){var n=o[0];var i=n.getCells();if(i.length>1){i[0].setSelectedKey(s.Vertical_ID||"");i[2].setValue(s.ConceptoOferta||"");i[3].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");i[4].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");i[5].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");i[6].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");i[7].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");i[8].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");i[9].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");i[10].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");i[11].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerLicencias(r)}else{console.log("No hay datos de recursos internos disponibles.")}}catch(e){console.error("Error al obtener los datos de Recursos Internos:",e);sap.m.MessageToast.show("Error al cargar los datos de Recursos Internos")}},leerLicencias:async function(e){var t=`/odata/v4/datos-cdo/LicenciasCon?$filter=otrosConceptos_ID eq ${e}`;try{const i=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!i.ok){const e=await i.text();throw new Error("Network response was not ok: "+e)}const l=await i.json();console.log("Datos traidos LicenciasCon TRAIDO:",l);var a=this.byId("table0_1727955577124");var o=a.getItems();if(l.value&&l.value.length>0){var s=l.value[0];var e=s.ID;if(o.length>0){var r=o[0];var n=r.getCells();if(n.length>1){n[0].setSelectedKey(s.Vertical_ID||"");n[2].setValue(s.ConceptoOferta||"");n[3].setText(s.PMJ?parseFloat(s.PMJ).toFixed(2):"0.00");n[4].setText(s.year1?parseFloat(s.year1).toFixed(2):"0.00");n[5].setText(s.year2?parseFloat(s.year2).toFixed(2):"0.00");n[6].setText(s.year3?parseFloat(s.year3).toFixed(2):"0.00");n[7].setText(s.year4?parseFloat(s.year4).toFixed(2):"0.00");n[8].setText(s.year5?parseFloat(s.year5).toFixed(2):"0.00");n[9].setText(s.year6?parseFloat(s.year6).toFixed(2):"0.00");n[10].setText(s.total?parseFloat(s.total).toFixed(2):"0.00");n[11].setText(s.totalC?parseFloat(s.total).toFixed(2):"0.00")}}await this.leerLicencias(e)}else{console.log("No hay datos de LicenciasCon disponibles.")}}catch(e){console.error("Error al obtener los datos de LicenciasCon:",e);sap.m.MessageToast.show("Error al cargar los datos de LicenciasCon")}},updateVizFrame1:function(e){var t=this.getView();var a=t.getModel("planning");if(!a){console.error("El modelo 'planning' no está definido.");return}if(!e||!e.value){console.log("Los datos del modelo son inválidos o no contienen 'value'.",e);return}var o=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});var s=e.value.map(function(e){var t=e.fecha_inicio?new Date(e.fecha_inicio):null;var a=e.fecha_fin?new Date(e.fecha_fin):null;if(t&&!isNaN(t.getTime())&&a&&!isNaN(a.getTime())){var s=(a-t)/(1e3*60*60*24);return{fase:e.hito,fechaInicio:o.format(t),fechaFin:o.format(a),duracion:s,label:`Inicio: ${o.format(t)}, Fin: ${o.format(a)}, Duración: ${s} días`}}else{console.warn("Fechas no válidas para el hito:",e);return null}}).filter(Boolean);a.setProperty("/chartData",s);console.log(s);this._aChartData=s;var r={};s.forEach(function(e){if(e.fase==="Kick off"){r.fechaInicioConstruccion=e.fechaInicio}if(e.fase==="Server post/prod"){r.fechaFinPruebasTQ=e.fechaFin}});var n=new sap.ui.model.json.JSONModel({fechas:[{fase:"Plan",fechaInicioConstruccion:r.fechaInicioConstruccion||"No definida",fechaFinPruebasTQ:r.fechaFinPruebasTQ||"No definida"}]});t.setModel(n,"fechasModel");this.updateVizFrame2(n)},updateVizFrame2:function(e){var t=this.getView();var a=t.getModel("planning");if(!(e instanceof sap.ui.model.json.JSONModel)||!e.getData){console.log("El modelo 'fechasModel' no está definido.");return}var o=e.getData().fechas;var s=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});var r=o.map(function(e){var t=e.fechaInicioConstruccion&&e.fechaInicioConstruccion!=="No definida"?new Date(e.fechaInicioConstruccion):null;var a=e.fechaFinPruebasTQ&&e.fechaFinPruebasTQ!=="No definida"?new Date(e.fechaFinPruebasTQ):null;if(t&&!isNaN(t.getTime())&&a&&!isNaN(a.getTime())){var o=(a-t)/(1e3*60*60*24);return{fase:e.fase,fechaInicio:s.format(t),fechaFin:s.format(a),duracion:o,label:`Inicio: ${s.format(t)}, Fin: ${s.format(a)}, Duración: ${o} días`}}else{console.log("Fechas no válidas para la fase:",e);return null}}).filter(Boolean);a.setProperty("/chartModel",r);console.log("Datos del gráfico:",r)},updateVizFrame3:function(){var e=this.getView();var t=e.getModel("planning");var a=t.getData();var o=sap.ui.core.format.DateFormat.getInstance({pattern:"yyyy-MM-dd"});var s=a.milestones.map(function(e){var t=e.fechaInicio?new Date(e.fechaInicio):null;var a=e.fechaFin?new Date(e.fechaFin):null;if(t&&a&&!isNaN(t)&&!isNaN(a)){var s=(a-t)/(1e3*60*60*24);return{fase:e.fase,fechaInicio:o.format(t),fechaFin:o.format(a),duracion:s,label:`Inicio: ${o.format(t)}, Fin: ${o.format(a)}, Duración: ${s} días`}}else{return null}}).filter(Boolean);t.setProperty("/chartData",s);console.log(s);this._aChartData=s;var r={};s.forEach(function(e){if(e.fase==="Kick off"){r.fechaInicioConstruccion=e.fechaInicio}if(e.fase==="Server post/prod"){r.fechaFinPruebasTQ=e.fechaFin}});var n=new sap.ui.model.json.JSONModel({fechas:[{fase:"Fechas Importantes",fechaInicioConstruccion:r.fechaInicioConstruccion,fechaFinPruebasTQ:r.fechaFinPruebasTQ}]});e.setModel(n,"fechasModel");this.updateVizFrame2(n)},onFechaChange:function(){this.updateVizFrame1();this.updateVizFrame3()},onPerfilChangeTabla1:function(e){this.updateRowData(e,["table_dimicFecha"])},updateRowData:function(e){const t=e.getSource();var a=this.byId("table_dimicFecha");var o=t.getParent();var s=a.indexOfItem(o);if(s===-1){console.error(`Índice de la fila no encontrado en la tabla ${oTableId}. Verifica la estructura de la tabla.`);return}else{console.log("Encontrada")}var r=a.getItems();var n=r[s].getCells();if(!n||n.length===0){console.error(`Datos de la fila no encontrados en la tabla ${oTableId}.`);return}var i=t.getSelectedItem().getText();var l={Director:{PMJ:1370.88,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"CG4.C":{PMJ:186.72,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"CG4.A":{PMJ:331.24,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"CG4.B":{PMJ:225.11,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},CG3:{PMJ:408.81,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},CG2:{PMJ:520.79,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},CG1:{PMJ:656.8,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0}};var c=l[i];if(c){n[4].setText(c.PMJ);n[5].setText(c["2024"]);n[6].setText(c["2025"]);n[7].setText(c["2026"]);n[8].setText(c["2027"]);n[9].setText(c["2028"]);n[10].setText(c["2029"]);var d=0;n[11].setText(d);var u=0;n[12].setText(u);console.log(u)}else{console.error(`No hay configuración definida para el valor seleccionado: ${i}`)}},selectFuncionchange:function(e){const t=e.getSource();const a=this.byId("tablaConsuExter");var o=t.getParent();var s=a.indexOfItem(o);if(s===-1){console.error(`Índice de la fila no encontrado en la tabla ${oTableId}. Verifica la estructura de la tabla.`);return}var r=a.getItems();var n=r[s].getCells();if(!n||n.length===0){console.error(`Datos de la fila no encontrados en la tabla ${oTableId}.`);return}var i=t.getSelectedItem().getText();var l={"Equipo Argentina - Analista":{PMJ:216.18,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Equipo Argentina - Asistente":{PMJ:190.74,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Equipo Argentina - Jefe":{PMJ:296.13,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Equipo Argentina - Gerente":{PMJ:478.34,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Basis - Consultor Junior":{PMJ:207.19,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Basis - Consultor Senior":{PMJ:356.21,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Basis - Arquitecto":{PMJ:356.21,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"QA - Análisis Funcional":{PMJ:278,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"QA - Jefe Proyecto":{PMJ:320,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"Testing - Análisis Funcional":{PMJ:180,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"TA - Consultor Senior 1-2":{PMJ:379.17,2024:0,2025:0,2026:0,2027:0,2028:0,2029:0},"TA - Consultor Senior 3":{PMJ:455.4,2024:.93,2025:0,2026:0,2027:0,2028:0,2029:0}};var c=l[i];if(c){n[4].setText(c.PMJ);n[5].setText(c["2024"]);n[6].setText(c["2025"]);n[7].setText(c["2026"]);n[8].setText(c["2027"]);n[9].setText(c["2028"]);n[10].setText(c["2029"]);var d=0;n[11].setText(d);var u=0;n[12].setText(u);console.log(u)}else{console.error(`No hay configuración definida para el valor seleccionado: ${i}`)}},token:async function(){try{let e=await fetch("/odata/v4/datos-cdo",{method:"GET",headers:{"x-csrf-token":"Fetch"}});if(!e.ok){throw new Error("Error al obtener el CSRF Token")}let t=e.headers.get("x-csrf-token");if(!t){throw new Error("No se recibió un CSRF Token")}console.log("CSRF Token obtenido:",t);localStorage.setItem("csrfToken",t);this._sCsrfToken=t}catch(e){console.error("Error en la llamada al servicio:",e);sap.m.MessageToast.show("Error al procesar el proyecto: "+e.message)}},getCsrfToken:function(){return localStorage.getItem("csrfToken")},sendRequest:async function(){const e=this.getCsrfToken();if(!e){console.log("No hay CSRF Token disponible, obteniendo uno...");await this.token()}const t=await fetch("/odata/v4/datos-cdo",{method:"GET",headers:{"x-csrf-token":e}});if(t.ok){const e=await t.json();console.log(e)}else{console.error("Error en la solicitud:",t.status)}},onSave:async function(){let e=0;const t=[];const a=this._sProjectID;const o=this._aChartData;const s=parseInt(this.byId("input0").getValue(),10);const r=this.byId("input1").getValue();const n=this.byId("box_pluriAnual").getSelected();const i=this.byId("id_Cfactur").getValue();const l=this.byId("box_multiJuridica").getSelected();const c=this.byId("int_clienteFun").getValue();const d=this.byId("idObje").getValue();const u=this.byId("idAsunyRestri").getValue();const h=this.byId("area0").getValue();const g=this.byId("date_inico").getDateValue();const x=this.byId("date_fin").getDateValue();const p=this.byId("input_ipc").getValue();console.log(c,n,i,l);var f=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd'T'HH:mm:ss"});const y=g?f.format(g):null;const T=x?f.format(x):null;const m=this.byId("idNatu").getSelectedKey();const I=this.byId("slct_area").getSelectedKey();const v=this.byId("slct_Jefe").getSelectedKey();const b=this.byId("slct_inic").getSelectedKey();const F=this.byId("selc_Segui").getSelectedKey();const C=this.byId("selc_ejcu").getSelectedKey();const w=this.byId("slct_client").getSelectedKey();const S=this.byId("slct_verti").getSelectedKey();const _=this.byId("selct_Amrecp").getSelectedKey();const E=(a,o,s)=>{if(!o||typeof o==="string"&&o.trim()===""){a.setValueState("Error");a.setValueStateText("Este campo es obligatorio");e++;if(!t.includes(s)){t.push(s)}}else{a.setValueState("None")}};E(this.byId("input0"),s,"Código del Proyecto");E(this.byId("input1"),r,"Nombre del Proyecto");if(e>0){const a=`Por favor, complete los siguientes campos: ${t.join(", ")}`;sap.m.MessageBox.warning(a,{title:"Advertencia"});const o=this.byId("idIniu");o.setCount(e);return}const N={codigoProyect:s,nameProyect:r,pluriAnual:n,funcionalString:c,clienteFacturacion:i,multijuridica:l,Naturaleza_ID:m,Area_ID:I,Iniciativa_ID:b,jefeProyectID_ID:v,objetivoAlcance:d,AsuncionesyRestricciones:u,Vertical_ID:S,Fechainicio:y,FechaFin:T,Seguimiento_ID:F,EjecucionVia_ID:C,AmReceptor_ID:_,clienteFuncional_ID:w,Estado:"Pendiente",datosExtra:h,IPC_apli:p};if(!N.codigoProyect||!N.nameProyect){sap.m.MessageToast.show("Error: Código y nombre del proyecto son obligatorios.");console.error("Validación fallida: Falta código o nombre del proyecto",N);return}console.log("Payload a enviar:",JSON.stringify(N,null,2));try{let e=this.getView().getModel();let t=e.sServiceUrl;let o;let s="/odata/v4/datos-cdo/DatosProyect";let r="POST";if(a){s=`/odata/v4/datos-cdo/DatosProyect(${a})`;r="PATCH"}let n=await fetch(t,{method:"GET",headers:{"x-csrf-token":"Fetch"}});if(!n.ok){throw new Error("Error al obtener el CSRF Token")}let i=n.headers.get("x-csrf-token");if(!i){throw new Error("No se recibió un CSRF Token")}console.log("✅ CSRF Token obtenido:",i);o=await fetch(s,{method:r,headers:{"Content-Type":"application/json","x-csrf-token":i},body:JSON.stringify(N)});if(!o.ok){const e=await o.text();console.error(`Error en ${r} (${o.status}):`,e);if(o.status===400){sap.m.MessageToast.show("Error 400: Datos incorrectos o incompletos.")}else if(o.status===404){sap.m.MessageToast.show("Error 404: Endpoint no encontrado.")}else if(o.status===500){sap.m.MessageToast.show("Error 500: Problema en el servidor o base de datos.")}else{sap.m.MessageToast.show(`Error ${o.status}: ${e}`)}throw new Error(`HTTP ${o.status} - ${e}`)}if(o.ok){const e=await o.json();console.log("Respuesta completa de la API:",e);const t=e.ID||e.data?.ID;console.log("ID generado:",t);if(t){await Promise.all([this.inserChart(t,i),this.insertarProveedor(t),this.insertFacturacion(t),this.insertClientFactura(t),this.insertRecursosInternos(t),this.insertCosumoExterno(t),this.insertRecursoExterno(t),this.insertarOtrosConceptos(t)]);this.getOwnerComponent().getRouter().navTo("app",{newId:t})}else{console.error("No se generó un ID válido.");sap.m.MessageToast.show("Error: No se generó un ID válido.")}}}catch(e){console.error("Error en la llamada al servicio:",e);sap.m.MessageToast.show("Error al procesar el proyecto: "+e.message)}},inserChart:async function(e,t){const a=this._aChartData;const o=this._idPlani;console.log("ID  = "+o);const s=a.map(t=>({hito:t.fase,fecha_inicio:t.fechaInicio,fecha_fin:t.fechaFin,duracion:this.formatDuration(t.duracion),datosProyect_ID:e}));try{let e;if(o){e=await fetch(`/odata/v4/datos-cdo/planificacion(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(s[0])});if(e.ok){const t=await e.json();console.log("Planificación actualizada con éxito:",t)}else{const t=await e.text();console.log("Error al actualizar la planificación:",t);sap.m.MessageToast.show("Error al actualizar la planificación: "+t)}}else{for(const e of s){const a=await fetch("/odata/v4/datos-cdo/planificacion",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(e)});if(a.ok){const e=await a.json();console.log("Planificación guardada con éxito:",e)}else{const e=await a.text();console.log("Error al guardar la planificación:",e);sap.m.MessageToast.show("Error al guardar la planificación: "+e)}}}}catch(e){console.error("Error en la operación:",e);sap.m.MessageToast.show("Ocurrió un error durante la operación.")}},insertFacturacion:async function(e){const t=this._sCsrfToken;var a=this.byId("table0");var o=a.getItems();var s=[];var r=parseInt(this.byId("text73_172746565340567").getText(),10);console.log("Total facturación:",r);o.forEach(function(t){var a=t.getCells();var o=a[0]&&a[0].getValue?a[0].getValue():"";var n=a[1]&&a[1].getValue?a[1].getValue():"";var i=a[2]&&a[2].getValue?parseInt(a[2].getValue(),10):0;if(o){var l=o.split("/");if(l.length===3){var c=new Date(l[2],l[1]-1,l[0]);if(!isNaN(c.getTime())){var d=c.toISOString().split("T")[0];s.push({fechaEstimida:d,descripcionHito:n,facturacion:i,total:r,datosProyect_ID:e})}else{console.error("Fecha inválida:",o)}}else{console.error("Formato de fecha incorrecto:",o)}}});for(let a of s){a.datosProyect_ID=e;const o=await fetch("/odata/v4/datos-cdo/Facturacion",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(a)});if(o.ok){const e=await o.json();console.log("Facturacion guardada con éxito:",e)}else{const e=await o.text();console.log("Error al guardar la Facturacion:",e);sap.m.MessageToast.show("Error al guardar la Facturacion: "+e)}}},insertarProveedor:async function(e,t){const a=this._sCsrfToken;console.log("TOKEN RECIBIDO EN PROVEEDOR:",a);var o=this.byId("table2");var s=o.getItems();var r=[];s.forEach(function(t){var a=t.getCells();var o=a[0].getValue();var s=a[1].getValue();var n=this.byId("box_condi").getSelected();var i=this.byId("box_prove").getSelected();r.push({checkCondi:n,checkProveedor:i,valueCondi:o,valueProvee:s,datosProyect_ID:e})}.bind(this));let n;for(let o of r){if(t){let s=await fetch(`/odata/v4/datos-cdo/ProveedoresC?$filter=datosProyect_ID eq '${t}'`);let r=await s.json();if(r.value&&r.value.length>0){let e=r.value[0].ID;n=await fetch(`/odata/v4/datos-cdo/ProveedoresC(${e})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":a},body:JSON.stringify(o)})}else{o.datosProyect_ID=e;n=await fetch("/odata/v4/datos-cdo/ProveedoresC",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":a},body:JSON.stringify(o)})}}else{o.datosProyect_ID=e;n=await fetch("/odata/v4/datos-cdo/ProveedoresC",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":a},body:JSON.stringify(o)})}let s=await n.json();console.log("Resultado:",s)}},insertRecursosInternos:async function(e){const t=this._sCsrfToken;const a=this._recurso_ID;console.log("ENTRANDO A RECURSO INTERNO -----\x3e>>> "+a);const o=this.byId("table_dimicFecha");const s=o.getItems();for(let o=0;o<s.length;o++){const r=s[o];const n=r.getCells()[0]?.getSelectedKey()||"";const i=r.getCells()[1]?.getSelectedKey()||"";const l=r.getCells()[2]?.getSelectedKey()||"";const c=r.getCells()[3]?.getValue()||"";const d=this.convertToInt(r.getCells()[4]?.getText()||"0");const u=parseInt(r.getCells()[5]?.getText()||"0",10);const h=parseInt(r.getCells()[6]?.getText()||"0",10);const g=parseInt(r.getCells()[7]?.getText()||"0",10);const x=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const f=parseInt(r.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(r.getCells()[11]?.getText()||"0");const T=this.convertToInt(r.getCells()[12]?.getText()||"0");if(!n||!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(o+1)+" correctamente.");return}const m={Vertical_ID:n,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(g.toFixed(2)),year4:Number(x.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(f.toFixed(2)),total:Number(y.toFixed(2)),totalE:Number(T.toFixed(2)),tipoServicio_ID:i,PerfilServicio_ID:l,datosProyect_ID:e};console.log("ID DE ACTUALIZACION -----\x3e>>>>",a);let I;if(a){I=await fetch(`/odata/v4/datos-cdo/RecursosInternos(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}else{I=await fetch("/odata/v4/datos-cdo/RecursosInternos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(I.ok){const e=await I.json();const t=e.ID;await this.insertOtrosGastos(t);await this.insertOtrosRecursos(t);await this.mesAñoRecurInterno(r,t);console.log("TERMINANDO  RECURSOS------");console.log("Fila "+(o+1)+" guardada con éxito: RECURSOS INTERNOS",e)}else{const e=await I.text();console.error("Error al guardar la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(o+1)+": "+e)}}},"mesAñoRecurInterno":async function(e,t){const a=this._sCsrfToken;const o={};const s=e.getParent().getColumns();for(let t=12;t<e.getCells().length;t++){const a=e.getCells()[t];let r;if(typeof a.getValue==="function"){r=a.getValue()}else if(typeof a.getText==="function"){r=a.getText()}else{console.warn(`Tipo de celda inesperado en la columna dinámica (índice ${t}):`,a);continue}if(r===null||r===undefined||r===""){console.warn(`Celda vacía o nula en columna ${t}, se omite el envío para esta columna.`);continue}let n=`Columna_${t}`;if(s[t]){const e=s[t].getHeader();if(e&&typeof e.getText==="function"){n=e.getText()||n}else{console.warn("No se pudo obtener el texto del encabezado en la columna",t)}}else{console.warn(`No se puede acceder a la columna en índice ${t}`)}console.log(`Encabezado obtenido (columnHeader) para columna ${t}:`,n);console.log(`Valor de la celda (dynamicValue) para columna ${t}:`,r);o[n]=this.convertToInt(r)}console.log("Datos a enviar:",o);for(const[e,s]of Object.entries(o)){if(s===null||s===undefined){console.warn(`No se puede enviar un valor nulo para mes ${e}.`);continue}const o={RecursosInternos_ID:t,mesAno:e,valor:s};console.log("Payload preparado para enviar:",o);try{const t=await fetch("/odata/v4/datos-cdo/ValorMensuReInter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":a},body:JSON.stringify(o)});if(!t.ok){const e=await t.text();throw new Error(`Error en la llamada al servicio: ${t.statusText}, Detalles: ${e}`)}else{console.log("Datos enviados con éxito para el mes:",e)}}catch(e){console.error("Error al enviar los datos:",e)}}},convertToInt:function(e){const t=parseInt(e,10);return isNaN(t)?0:t},insertOtrosGastos:async function(e){const t=this._sCsrfToken;let a;const o=this._RecuOtrse;const s=this.byId("table0_1727879576857");const r=s.getItems();for(let s=0;s<r.length;s++){const n=r[s];const i=n.getCells()[0].getSelectedKey();const l=n.getCells()[1].getSelectedKey();const c=n.getCells()[3].getValue();const d=this.convertToInt(n.getCells()[4].getText());const u=parseInt(n.getCells()[5]?.getText()||"0",10);const h=parseInt(n.getCells()[6]?.getText()||"0",10);const g=parseInt(n.getCells()[7]?.getText()||"0",10);const x=parseInt(n.getCells()[8]?.getText()||"0",10);const p=parseInt(n.getCells()[9]?.getText()||"0",10);const f=parseInt(n.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(n.getCells()[11].getText());const T=this.convertToInt(n.getCells()[12].getText());if(!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(s+1)+" correctamente.");return}const m={Vertical_ID:i,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(g.toFixed(2)),year4:Number(x.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(f.toFixed(2)),total:Number(y.toFixed(2)),totalE:T,tipoServicio_ID:l,RecursosInternos_ID:e};try{if(o){a=await fetch(`/odata/v4/datos-cdo/otrosGastoRecu(${o})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t}})}else{a=await fetch("/odata/v4/datos-cdo/otrosGastoRecu",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(a.ok){const e=await a.json();console.log("Fila "+(s+1)+" guardada con éxito: INSERT OTROS GASTOS ",e)}else{const e=await a.text();console.error("Error al guardar la fila "+(s+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(s+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(s+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(s+1)+": "+e.message)}}},insertOtrosRecursos:async function(e){const t=this._sCsrfToken;const a=this._idConOS;const o=this.byId("table0_1727879940116");const s=o.getItems();for(let o=0;o<s.length;o++){const r=s[o];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const g=parseInt(r.getCells()[8]?.getText()||"0",10);const x=parseInt(r.getCells()[9]?.getText()||"0",10);const p=parseInt(r.getCells()[10]?.getText()||"0",10);const f=this.convertToInt(r.getCells()[11].getText());const y=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||isNaN(c)||isNaN(f)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(o+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(g.toFixed(2)),year5:Number(x.toFixed(2)),year6:Number(p.toFixed(2)),total:Number(f.toFixed(2)),totalE:y,tipoServicio_ID:i,RecursosInternos_ID:e};try{if(a){response=await fetch(`/odata/v4/datos-cdo/otrosGastoRecu(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t}})}else{response=await fetch("/odata/v4/datos-cdo/otrosGastoRecu",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(response.ok){const e=await response.json();console.log("Fila "+(o+1)+" guardada con éxito: OTROS RECURSOS ",e)}else{const e=await response.text();console.error("Error al guardar la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(o+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(o+1)+": "+e.message)}}},insertCosumoExterno:async function(e){try{const t=this._sCsrfToken;const a=this._idConsum;console.log("Token CSRF:",t);console.log("ID CONSUMO EXTERNO:",a);const o=this.byId("tablaConsuExter");const s=o.getItems();if(!s.length){console.warn("No hay elementos en la tabla para insertar.");return}for(let o=0;o<s.length;o++){const r=s[o];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[2].getSelectedKey();const c=r.getCells()[3].getValue();const d=this.convertToInt(r.getCells()[4].getText());const u=parseFloat(r.getCells()[5]?.getText()||"0");const h=parseFloat(r.getCells()[6]?.getText()||"0");const g=parseFloat(r.getCells()[7]?.getText()||"0");const x=parseFloat(r.getCells()[8]?.getText()||"0");const p=parseFloat(r.getCells()[9]?.getText()||"0");const f=parseFloat(r.getCells()[10]?.getText()||"0");const y=this.convertToInt(r.getCells()[11].getText());const T=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show(`Por favor, rellena todos los campos en la fila ${o+1} correctamente.`);console.warn(`Faltan datos en la fila ${o+1}.`);return}const m={Vertical_ID:n,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(g.toFixed(2)),year4:Number(x.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(f.toFixed(2)),total:y,totalC:T,tipoServicio_ID:i,PerfilConsumo_ID:l,datosProyect_ID:e};let I,v;if(a){I=`/odata/v4/datos-cdo/ConsumoExternos(${a})`;v="PATCH"}else{I="/odata/v4/datos-cdo/ConsumoExternos";v="POST"}console.log(`Ejecutando ${v} en:`,I,"Payload:",m);let b={"Content-Type":"application/json","x-csrf-token":t};if(v==="PATCH"){b["If-Match"]="*"}let F=await fetch(I,{method:v,headers:b,body:JSON.stringify(m)});if(!F.ok){const e=await F.text();console.error(`Error en ${v} para la fila ${o+1}:`,e);sap.m.MessageToast.show(`Error ${v} fila ${o+1}: ${F.status} - ${F.statusText}`);return}const C=await F.json();console.log(`Fila ${o+1} guardada con éxito. Respuesta:`,C);if(!C.ID){console.error("No se devolvió un ID en la respuesta del servidor.");sap.m.MessageToast.show(`Error al obtener ID de la fila ${o+1}`);return}await Promise.all([this.insertServiConsu(C.ID),this.insertGastoConsu(C.ID)]);console.log(`Fila ${o+1} procesada correctamente.`)}}catch(e){console.error("Error en la ejecución del proceso:",e);sap.m.MessageToast.show(`Error general: ${e.message}`)}},insertServiConsu:async function(e){const t=this._sCsrfToken;const a=this._idConOS;const o=this.byId("idOtroserConsu");const s=o.getItems();for(let o=0;o<s.length;o++){const r=s[o];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const g=parseInt(r.getCells()[8]?.getText()||"0",10);const x=parseInt(r.getCells()[9]?.getText()||"0",10);const p=parseInt(r.getCells()[10]?.getText()||"0",10);const f=this.convertToInt(r.getCells()[5].getText());const y=this.convertToInt(r.getCells()[6].getText());if(!n||!i||!l||isNaN(c)||isNaN(f)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(o+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(g.toFixed(2)),year5:Number(x.toFixed(2)),year6:Number(p.toFixed(2)),total:Number(f.toFixed(2)),totalE:y,tipoServicio_ID:i,ConsumoExternos_ID:e};try{if(a){response=await fetch(`/odata/v4/datos-cdo/otrosServiciosConsu(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{response=await fetch("/odata/v4/datos-cdo/otrosServiciosConsu",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(response.ok){const e=await response.json();console.log("Fila "+(o+1)+" guardada con éxito: INSERT SERVI ",e)}else{const e=await response.text();console.error("Error al guardar la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(o+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(o+1)+": "+e.message)}}},insertGastoConsu:async function(e){const t=this._sCsrfToken;const a=this._idGasVi;const o=this.byId("idGastoViajeConsu");const s=o.getItems();for(let o=0;o<s.length;o++){const r=s[o];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[3].getValue();const c=this.convertToInt(r.getCells()[4].getText());const d=parseInt(r.getCells()[5]?.getText()||"0",10);const u=parseInt(r.getCells()[6]?.getText()||"0",10);const h=parseInt(r.getCells()[7]?.getText()||"0",10);const g=parseInt(r.getCells()[8]?.getText()||"0",10);const x=parseInt(r.getCells()[9]?.getText()||"0",10);const p=parseInt(r.getCells()[10]?.getText()||"0",10);const f=this.convertToInt(r.getCells()[11].getText());const y=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||isNaN(c)||isNaN(f)||isNaN(y)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(o+1)+" correctamente.");return}const T={Vertical_ID:n,ConceptoOferta:l,PMJ:c,year1:Number(d.toFixed(2)),year2:Number(u.toFixed(2)),year3:Number(h.toFixed(2)),year4:Number(g.toFixed(2)),year5:Number(x.toFixed(2)),year6:Number(p.toFixed(2)),total:f,totalE:y,tipoServicio_ID:i,ConsumoExternos_ID:e};try{if(a){response=await fetch(`/odata/v4/datos-cdo/GastoViajeConsumo(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}else{response=await fetch("/odata/v4/datos-cdo/GastoViajeConsumo",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(T)})}if(response.ok){const e=await response.json();console.log("Fila "+(o+1)+" guardada con éxito: INSERTVIAJES CONSUMO ",e)}else{const e=await response.text();console.error("Error al guardar la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(o+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(o+1)+": "+e.message)}}},insertRecursoExterno:async function(e){const t=this._sCsrfToken;const a=this._idRecEx;const o=this.byId("tablaRecExterno");const s=o.getItems();for(let o=0;o<s.length;o++){const r=s[o];const n=r.getCells()[0].getSelectedKey();const i=r.getCells()[1].getSelectedKey();const l=r.getCells()[2].getValue();const c=r.getCells()[3].getValue();const d=this.convertToInt(r.getCells()[4].getValue());const u=parseInt(r.getCells()[5]?.getText()||"0",10);const h=parseInt(r.getCells()[6]?.getText()||"0",10);const g=parseInt(r.getCells()[7]?.getText()||"0",10);const x=parseInt(r.getCells()[8]?.getText()||"0",10);const p=parseInt(r.getCells()[9]?.getText()||"0",10);const f=parseInt(r.getCells()[10]?.getText()||"0",10);const y=this.convertToInt(r.getCells()[11].getText());const T=this.convertToInt(r.getCells()[12].getText());if(!n||!i||!l||!c||isNaN(d)||isNaN(y)||isNaN(T)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(o+1)+" correctamente.");return}const m={Vertical_ID:n,ConceptoOferta:c,PMJ:d,year1:Number(u.toFixed(2)),year2:Number(h.toFixed(2)),year3:Number(g.toFixed(2)),year4:Number(x.toFixed(2)),year5:Number(p.toFixed(2)),year6:Number(f.toFixed(2)),total:y,totalR:T,tipoServicio_ID:i,PerfilServicio:l,datosProyect_ID:e};try{if(a){response=await fetch(`/odata/v4/datos-cdo/RecursosExternos(${a})`,{method:"PATCH",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}else{response=await fetch("/odata/v4/datos-cdo/RecursosExternos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(m)})}if(response.ok){const e=await response.json();const t=e.ID;await this.insertServicioRecuExter(t);await this.insertGastoViajeExterno(t);console.log("Fila "+(o+1)+" guardada con éxito:RECURSO EXTERNO",e)}else{const e=await response.text();console.error("Error al guardar la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error al guardar la fila "+(o+1)+": "+e)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(o+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(o+1)+": "+e.message)}}},insertServicioRecuExter:async function(e){const t=this._sCsrfToken;const a=this.byId("idServiExterno");const o=a.getItems();for(let a=0;a<o.length;a++){const s=o[a];const r=s.getCells()[0].getSelectedKey();const n=s.getCells()[1].getSelectedKey();const i=s.getCells()[3].getValue();const l=this.convertToInt(s.getCells()[4].getText());const c=parseInt(s.getCells()[5]?.getText()||"0",10);const d=parseInt(s.getCells()[6]?.getText()||"0",10);const u=parseInt(s.getCells()[7]?.getText()||"0",10);const h=parseInt(s.getCells()[8]?.getText()||"0",10);const g=parseInt(s.getCells()[9]?.getText()||"0",10);const x=parseInt(s.getCells()[10]?.getText()||"0",10);const p=this.convertToInt(s.getCells()[11].getText());const f=this.convertToInt(s.getCells()[12].getText());if(!r||!n||!i||isNaN(l)||isNaN(p)||isNaN(f)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const y={Vertical_ID:r,ConceptoOferta:i,PMJ:l,year1:Number(c.toFixed(2)),year2:Number(d.toFixed(2)),year3:Number(u.toFixed(2)),year4:Number(h.toFixed(2)),year5:Number(g.toFixed(2)),year6:Number(x.toFixed(2)),total:p,totalE:f,tipoServicio_ID:n,RecursosExternos_ID:e};try{const e=await fetch("/odata/v4/datos-cdo/serviRecurExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(y)});if(e.ok){const t=await e.json();console.log("Fila "+(a+1)+" guardada con éxito: SERVICIO EXTERNO  ",t)}else{const t=await e.text();console.error("Error al guardar la fila "+(a+1)+":",t);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+t)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertGastoViajeExterno:async function(e){const t=this._sCsrfToken;const a=this.byId("idGastoRecuExter");const o=a.getItems();for(let a=0;a<o.length;a++){const s=o[a];const r=s.getCells()[0].getSelectedKey();const n=s.getCells()[1].getSelectedKey();const i=s.getCells()[3].getValue();const l=this.convertToInt(s.getCells()[4].getText());const c=parseInt(s.getCells()[5]?.getText()||"0",10);const d=parseInt(s.getCells()[6]?.getText()||"0",10);const u=parseInt(s.getCells()[7]?.getText()||"0",10);const h=parseInt(s.getCells()[8]?.getText()||"0",10);const g=parseInt(s.getCells()[9]?.getText()||"0",10);const x=parseInt(s.getCells()[10]?.getText()||"0",10);const p=this.convertToInt(s.getCells()[11].getText());const f=this.convertToInt(s.getCells()[12].getText());if(!r||!n||!i||isNaN(l)||isNaN(p)||isNaN(f)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const y={Vertical_ID:r,ConceptoOferta:i,PMJ:l,year1:Number(c.toFixed(2)),year2:Number(d.toFixed(2)),year3:Number(u.toFixed(2)),year4:Number(h.toFixed(2)),year5:Number(g.toFixed(2)),year6:Number(x.toFixed(2)),total:p,totalE:f,tipoServicio_ID:n,RecursosExternos_ID:e};try{const e=await fetch("/odata/v4/datos-cdo/GastoViajeRecExter",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(y)});if(e.ok){const t=await e.json();console.log("Fila "+(a+1)+" guardada con éxito: INSERTVIAJES RECURSO EXTERNO  ",t)}else{const t=await e.text();console.error("Error al guardar la fila "+(a+1)+":",t);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+t)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertarOtrosConceptos:async function(e){const t=this._sCsrfToken;const a=this.byId("table0_1724413700665");const o=a.getItems();for(let a=0;a<o.length;a++){const s=o[a];const r=s.getCells()[0].getSelectedKey();const n=s.getCells()[2].getValue();const i=this.convertToInt(s.getCells()[3]?.getText());const l=parseInt(s.getCells()[4]?.getText()||"0",10);const c=parseInt(s.getCells()[5]?.getText()||"0",10);const d=parseInt(s.getCells()[6]?.getText()||"0",10);const u=parseInt(s.getCells()[7]?.getText()||"0",10);const h=parseInt(s.getCells()[8]?.getText()||"0",10);const g=parseInt(s.getCells()[9]?.getText()||"0",10);const x=this.convertToInt(s.getCells()[10]?.getText());const p=this.convertToInt(s.getCells()[11]?.getText());if(!r||!n||isNaN(i)||isNaN(x)||isNaN(p)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const f={Vertical_ID:r,ConceptoOferta:n,PMJ:i,year1:Number(l.toFixed(2)),year2:Number(c.toFixed(2)),year3:Number(d.toFixed(2)),year4:Number(u.toFixed(2)),year5:Number(h.toFixed(2)),year6:Number(g.toFixed(2)),total:x,totalC:p,datosProyect_ID:e};try{const e=await fetch("/odata/v4/datos-cdo/otrosConceptos",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(f)});if(e.ok){const t=await e.json();const o=t.ID;await this.insertarLicencia(o);console.log("Fila "+(a+1)+" guardada con éxito: INSERTVIAJES RECURSO EXTERNO  ",t)}else{const t=await e.text();console.error("Error al guardar la fila "+(a+1)+":",t);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+t)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},insertarLicencia:async function(e){const t=this._sCsrfToken;const a=this.byId("table0_1727955577124");const o=a.getItems();for(let a=0;a<o.length;a++){const s=o[a];const r=s.getCells()[0].getSelectedKey();const n=s.getCells()[2].getValue();const i=this.convertToInt(s.getCells()[3]?.getText());const l=parseInt(s.getCells()[5]?.getText()||"0",10);const c=parseInt(s.getCells()[6]?.getText()||"0",10);const d=parseInt(s.getCells()[7]?.getText()||"0",10);const u=parseInt(s.getCells()[8]?.getText()||"0",10);const h=parseInt(s.getCells()[9]?.getText()||"0",10);const g=parseInt(s.getCells()[10]?.getText()||"0",10);const x=this.convertToInt(s.getCells()[4]?.getText());const p=this.convertToInt(s.getCells()[5]?.getText());if(!r||!n||isNaN(i)||isNaN(x)||isNaN(p)){sap.m.MessageToast.show("Por favor, rellena todos los campos en la fila "+(a+1)+" correctamente.");return}const f={Vertical_ID:r,ConceptoOferta:n,PMJ:i,year1:Number(l.toFixed(2)),year2:Number(c.toFixed(2)),year3:Number(d.toFixed(2)),year4:Number(u.toFixed(2)),year5:Number(h.toFixed(2)),year6:Number(g.toFixed(2)),total:x,totalC:p,otrosConceptos_ID:e};try{const e=await fetch("/odata/v4/datos-cdo/LicenciasCon",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(f)});if(e.ok){const t=await e.json();console.log("Fila "+(a+1)+" guardada con éxito: INSERTAR LICENCIA ",t)}else{const t=await e.text();console.error("Error al guardar la fila "+(a+1)+":",t);sap.m.MessageToast.show("Error al guardar la fila "+(a+1)+": "+t)}}catch(e){console.error("Error en la llamada al servicio para la fila "+(a+1)+":",e);sap.m.MessageToast.show("Error en la llamada al servicio para la fila "+(a+1)+": "+e.message)}}},convertToInt:function(e){const t=parseInt(e,10);return isNaN(t)?null:t},insertClientFactura:async function(e){const t=this._sCsrfToken;var a=this.byId("table_clienteFac");var o=a.getItems();var s=[];var r=0;o.forEach(function(t,a){if(a===o.length-1){return}var r=t.getCells();var n="";var i="";if(r[0]&&r[0].getMetadata().getName()==="sap.m.Input"){n=r[0].getValue()}else if(r[0]&&r[0].getMetadata().getName()==="sap.m.Text"){n=r[0].getText()}if(r[1]&&r[1].getMetadata().getName()==="sap.m.Input"){i=r[1].getValue()}else if(r[1]&&r[1].getMetadata().getName()==="sap.m.Text"){i=r[1].getText()}var l=this.byId("text73_172746565340567").getText();if(n!==""||i!==""){s.push({juridica:n,oferta:i,total:l,datosProyect_ID:e})}}.bind(this));console.log("Total de la columna oferta: ",r);for(let e of s){const a=await fetch("/odata/v4/datos-cdo/ClientFactura",{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":t},body:JSON.stringify(e)});if(a.ok){const e=await a.json()}else{const e=await a.text();console.log("Error al guardar la Facturacion:",e);sap.m.MessageToast.show("Error al guardar la Facturacion: "+e)}}sap.m.MessageToast.show("El total de la columna oferta es: "+r)},metodoSumar:function(){var e=this.byId("table_clienteFac");var t=e.getItems();var a=0;console.log("Cantidad de filas en la tabla:",t.length);t.forEach(function(e,o){if(o<t.length-1){var s=e.getCells();var r="";var n=s[1];if(n.getMetadata().getName()==="sap.m.Input"){r=n.getValue()}r=r.trim();var i=parseFloat(r);console.log("Fila:",o,"Valor de la celda:",r,"-> Valor numérico:",i);if(!isNaN(i)){a+=i;console.log("Total acumulado hasta ahora:",a)}}});this.byId("text73_172746565340567").setText(a.toFixed(2));console.log("Total de la columna oferta:",a);this._totalOferta=a},metodoSumarFac:function(){var e=this.byId("table0");var t=e.getItems();var a=0;console.log("Cantidad de filas en la tabla:",t.length);t.forEach(function(e,o){if(o<t.length-1){var s=e.getCells();var r="";var n=s[2];if(n.getMetadata().getName()==="sap.m.Input"){r=n.getValue()}r=r.trim();var i=parseFloat(r);console.log("Fila:",o,"Valor de la celda:",r,"-> Valor numérico:",i);if(!isNaN(i)){a+=i;console.log("Total acumulado hasta ahora:",a)}}});this.byId("text73_172746565340569997").setText(a.toFixed(2));console.log("Total de la columna oferta:",a)},formatDuration:function(e){const t=Math.floor(e);const a=Math.floor((e-t)*60);const o=0;return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`},onClearFields:function(){var e=this.getView();function t(e){if(e instanceof sap.m.Input){e.setValue("")}else if(e instanceof sap.m.Select||e instanceof sap.m.ComboBox){e.setSelectedKey("")}else if(e instanceof sap.m.DatePicker){e.setDateValue(null)}else if(e instanceof sap.m.TextArea){e.setValue("")}else if(e instanceof sap.m.CheckBox){e.setSelected(false)}if(e.getAggregation){const a=e.getMetadata().getAllAggregations();for(let o in a){const a=e.getAggregation(o);if(Array.isArray(a)){a.forEach(t)}else if(a instanceof sap.ui.core.Control){t(a)}}}}e.findAggregatedObjects(false,t)},onSelectIniMethod:function(e){this.onInputChange(e);this.onSelectOpx(e)},onselectmethodsetinfo:function(e){this.onInputChange(e);this.fechasDinamicas(e)},onAddRowPress:function(e){console.log(e);var t=this.byId(e);if(t){var a=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Select({selectedKey:"{TipoServicio>valueTipoServ}",forceSelection:false,items:{path:"/TipoServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreTipoServ}"})}}),new sap.m.Select({selectedKey:"{PerfilServicio>valuePerfil}",forceSelection:false,items:{path:"/PerfilServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombrePerfil}"})},change:this.updateRowData.bind(this)}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(a);this.fechasDinamicas();var o={getSource:()=>a};this.updateRowData(o)}else{console.error("No se encontró la tabla con ID: "+e)}},onAddRowPress2:function(e){var t=this.byId(e);if(!t){t=sap.ui.getCore().byId("container-project1---view--tablaConsuExter")}if(t){var a=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Select({selectedKey:"{TipoServicio>valueTipoServ}",forceSelection:false,items:{path:"/TipoServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreTipoServ}"})}}),new sap.m.Select({selectedKey:"{PerfilConsumo>valuePerfilC}",forceSelection:false,items:{path:"/PerfilConsumo",template:new sap.ui.core.Item({key:"{ID}",text:"{nombrePerfilC}"})},change:this.selectFuncionchange.bind(this)}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(a);this.fechasDinamicas();var o={getSource:()=>a};this.selectFuncionchange(o)}else{console.error("No se encontró la tabla con ID: "+e)}},onAddRowPress4:function(e){console.log(e);var t=this.byId("table0_1724413700665");if(t){var a=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Text({text:""}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(a);this.fechasDinamicas()}else{console.error("No se encontró la tabla con ID: "+e)}},onAddRowPress3:function(e){console.log(e);var t=this.byId("tablaRecExterno");if(t){var a=new sap.m.ColumnListItem({cells:[new sap.m.Select({selectedKey:"{Vertical>valueVertical}",forceSelection:false,items:{path:"/Vertical",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreVertical}"})}}),new sap.m.Select({selectedKey:"{TipoServicio>valueTipoServ}",forceSelection:false,items:{path:"/TipoServicio",template:new sap.ui.core.Item({key:"{ID}",text:"{NombreTipoServ}"})}}),new sap.m.Input({value:""}),new sap.m.Input({value:""}),new sap.m.Input({value:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});t.addItem(a);this.fechasDinamicas()}else{console.error("No se encontró la tabla con ID: "+e)}},onDateChange:function(){this.updateVizFrame()},fechasDinamicas:function(e){var t=this.getView().byId("date_inico");var a=this.getView().byId("date_fin");if(!t||!a){console.error("Error: No se pudieron obtener los DatePickers.");return}var o=t.getDateValue();var s=a.getDateValue();if(!o||!s){console.log("Esperando a que se seleccionen ambas fechas.");return}var r=this.getMonthsDifference(o,s);var n=["box0_1714747137718","box0_1727879568594","box0_1727879817594","box0_1721815443829","box0_1727948724833","box0_1727950351451","box0_17218154429","box0_1727953252765","box1_1727953468615","box0_17254429","box0_1727955568380"];n.forEach(e=>{var t=this.getView().byId(e);if(t){t.setWidth(r>3?"3000px":"100%")}});var i=["tablaConsuExter","table_dimicFecha","tablaRecExterno","idOtroserConsu","idGastoViajeConsu","idServiExterno","idGastoRecuExter","table0_1724413700665","table0_1727955577124","table0_1727879576857","table0_1727879940116"];i.forEach(e=>{var t=this.getView().byId(e);if(!t){console.error("Error: No se pudo obtener la tabla con ID "+e);return}var a=t.getColumns().length;for(var n=a-1;n>=0;n--){var i=t.getColumns()[n].getHeader();if(i&&/\d{4}-\w+/.test(i.getText())){t.removeColumn(t.getColumns()[n])}}var l=this.findTotalColumnIndex(t);for(var c=0;c<=r;c++){var d=new Date(o.getFullYear(),o.getMonth()+c,1);var u=d.getFullYear();var h=d.toLocaleString("default",{month:"long"});var g=u+"-"+h;var x=new sap.m.Column({header:new sap.m.Label({text:g}),width:"100px"});t.insertColumn(x,l+1+c);for(var p=0;p<t.getItems().length;p++){var f=t.getItems()[p];var y=new sap.m.Input({placeholder:"0.00",change:this.handleInputChange.bind(this,e,p,c,u)});f.addCell(y)}}var T=this.getView().byId("scroll_container_"+e);if(T){T.setHorizontal(true);T.setVertical(false);T.setWidth("100%")}console.log("startDate:",o);console.log("endDate:",s)})},resetYearlySums:function(){if(this._yearlySums&&this.currentRow!==undefined){this._yearlySums[this.currentRow]={}}},handleInputChange:function(e,t,a,o,s){var r=parseFloat(s.getParameter("value"))||0;console.log(`1. Nuevo valor ingresado en la tabla ${e}, fila ${t}, columna ${a}: ${r}`);if(!this._tableValues){this._tableValues={}}if(!this._tableValues[e]){this._tableValues[e]={}}if(!this._tableValues[e][t]){this._tableValues[e][t]={}}this._tableValues[e][t][a]=r;if(!this._editedRows[e]){this._editedRows[e]=new Set}this._editedRows[e].add(t);this._tableChanged=true;if(!this._yearlySums[t]){this._yearlySums[t]={}}if(!this._yearlySums[t][o]){this._yearlySums[t][o]=0}this.currentTable=e;this._yearlySums[t][o]+=r;console.log(`2. Suma acumulada para el año ${o} en fila ${t}: ${this._yearlySums[t][o]}`);this.updateTotalField(e,t,r);console.log(`3. Suma total para el año ${o} en fila ${t}: ${this._yearlySums[t][o]}`)},updateTotalField:function(e,t,a,o,s){console.log("1. updateTotal ----\x3e>> "+t+a);var r=0;var n=0;var i=0;var l=0;var c=0;let d=0;var u,h,g;var x=this.getTotalForYear(2024,t,true,e);var p=this.getTotalForYear(2025,t,true,e);var f=this.getTotalForYear(2026,t,true,e);var y=this.getTotalForYear(2027,t,true,e);var T=this.getTotalForYear(2028,t,true,e);var m=this.getTotalForYear(2029,t,true,e);if(e==="tablaConsuExter"){var I=this.byId("tablaConsuExter");if(!I){console.error(" 2. La tabla 'tablaConsuExter' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){r=a[4].getText();a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");n=x+p+f+y+T+m;var o=r*n;a[11].setText(n.toFixed(2)+"€");a[12].setText(o+"€")}}});this.onSumarColumna(e)}else if(e==="table_dimicFecha"){var I=this.byId("table_dimicFecha");if(!I){console.error("3. La tabla 'table_dimicFecha' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){var o=a[4].getText();a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");i=x+p+f+y+T+m;var s=o*i;a[11].setText(i.toFixed(2));a[12].setText(s+"€")}}});this.onSumarColumna(e)}else if(e==="tablaRecExterno"){var I=this.byId("tablaRecExterno");if(!I){console.error("4. La tabla 'tablaRecExterno' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){var o=a[4].getValue();a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");l=x+p+f+y+T+m;a[11].setText(l.toFixed(2)+"€");var s=o*l;a[12].setText(s+"€")}}});this.onSumarColumna(e)}else if(e==="idOtroserConsu"){var I=this.byId("idOtroserConsu");if(!I){console.error("La tabla 'idOtroserConsu' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[11].setText(o.toFixed(2)+"€");a[12].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="idGastoViajeConsu"){var I=this.byId("idGastoViajeConsu");if(!I){console.error("La tabla 'idGastoViajeConsu' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[11].setText(o.toFixed(2)+"€");a[12].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="idServiExterno"){var I=this.byId("idServiExterno");if(!I){console.error("La tabla 'idServiExterno' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[11].setText(o.toFixed(2)+"€");a[12].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="idGastoRecuExter"){var I=this.byId("idGastoRecuExter");if(!I){console.error("La tabla 'idGastoRecuExter' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[11].setText(o.toFixed(2)+"€");a[12].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="table0_1724413700665"){var I=this.byId("table0_1724413700665");if(!I){console.error("La tabla 'table0_1724413700665' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[4].setText(x.toFixed(2)+"€");a[5].setText(p.toFixed(2)+"€");a[6].setText(f.toFixed(2)+"€");a[7].setText(y.toFixed(2)+"€");a[8].setText(T.toFixed(2)+"€");a[9].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[10].setText(o.toFixed(2)+"€");a[11].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="table0_1727955577124"){var I=this.byId("table0_1727955577124");if(!I){console.error("La tabla 'table0_1727955577124' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=12){a[4].setText(x.toFixed(2)+"€");a[5].setText(p.toFixed(2)+"€");a[6].setText(f.toFixed(2)+"€");a[7].setText(y.toFixed(2)+"€");a[8].setText(T.toFixed(2)+"€");a[9].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[10].setText(o.toFixed(2)+"€");a[11].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="table0_1727879576857"){var I=this.byId("table0_1727879576857");if(!I){console.error("La tabla 'table0_1727879576857' no fue encontrada.");return}this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[11].setText(o.toFixed(2)+"€");a[12].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else if(e==="table0_1727879940116"){var I=this.byId("table0_1727879940116");if(!I){console.error("La tabla 'table0_1727879940116' no fue encontrada.");return}console.log("tabla encontrada ",e);this._editedRows[e].forEach(function(e){var t=I.getItems()[e];if(t){var a=t.getCells();if(a&&a.length>=11){a[5].setText(x.toFixed(2)+"€");a[6].setText(p.toFixed(2)+"€");a[7].setText(f.toFixed(2)+"€");a[8].setText(y.toFixed(2)+"€");a[9].setText(T.toFixed(2)+"€");a[10].setText(m.toFixed(2)+"€");var o=x+p+f+y+T+m;a[11].setText(o.toFixed(2)+"€");a[12].setText(o.toFixed(2)+"€")}}});this.onSumarColumna(e)}else{console.error("Tabla no reconocida: "+e)}this._editedRows[e].clear()},getTotalForYear:function(e,t,a){console.log("1. AÑO GETTOTAL -----\x3e>>",e+" Fila actual: ",t+" Datos actuales:",this._yearlySums);if(Number(t)!==Number(this.currentRow)){console.log("Cambiando de fila de "+this.currentRow+" a "+t);this.resetYearlySums();this.currentRow=Number(t);console.log("CURRENTROW actualizada a: ",this.currentRow)}if(this._yearlySums&&this._yearlySums[t]&&this._yearlySums[t][e]!==undefined){console.log("Contenido de _yearlySums para fila:",this._yearlySums[t]);return this._yearlySums[t][e]}else{console.warn(`2. No se encontró datos para el año ${e} en fila ${t}`);return 0}},onSumarColumna:function(e){var t=this.byId(e);var a=t.getItems();var o=0;var s=0;var r=0;var n=0;var i=0;a.forEach(function(e){var t=e.getCells();var a=t.length>11&&t[11].getText?t[11].getText():"0";var l=t.length>12&&t[12].getText?t[12].getText():"0";o+=parseFloat(a)||0;s+=parseFloat(l)||0;r+=parseFloat(a)||0;n+=parseFloat(a)||0;i+=parseFloat(a)||0});if(e==="table_dimicFecha"){this.byId("inputReInter").setValue(o.toFixed(2));this.byId("inputServi1").setValue(s.toFixed(2)+"€")}else if(e==="table0_1727879576857"){this.byId("inputOtrosServi1").setValue(r.toFixed(2)+"€")}else if(e==="table0_1727879940116"){this.byId("inputGastoVia1").setValue(n.toFixed(2)+"€")}else if(e==="table0_1727955577124"){this.byId("input0_1724758359").setValue(r.toFixed(2)+"€")}else if(e==="tablaRecExterno"){this.byId("inputRcurExtern").setValue(o.toFixed(2)+"€");this.byId("inputServi").setValue(s.toFixed(2)+"€")}else if(e==="idServiExterno"){this.byId("input10_1724757017406").setValue(o.toFixed(2)+"€")}else if(e==="idGastoRecuExter"){this.byId("input9_1724757015442").setValue(o.toFixed(2)+"€")}else if(e==="tablaConsuExter"){this.byId("inputServi2").setValue(s.toFixed(2));this.byId("inputConsuEx").setValue(o.toFixed(2))}else if(e==="idOtroserConsu"){this.byId("inputOtroSer2").setValue(r.toFixed(2)+"€")}else if(e==="idGastoViajeConsu"){this.byId("inptGastoVi2").setValue(r.toFixed(2)+"€")}else if(e==="table0_1724413700665"){this.byId("totalInfraestruc").setValue(o.toFixed(2)+"€")}this.onColumnTotales();console.log("Suma total de la columna Precio:",o);console.log("Suma total de la columna Precio:",s);return o},onColumnTotales:function(){var e=0;var t=0;var a=0;var o=0;var s=0;var r=parseFloat(this.byId("inputReInter").getValue())||0;var n=parseFloat(this.byId("inputConsuEx").getValue())||0;var i=parseFloat(this.byId("inputRcurExtern").getValue())||0;e=r+n+i;this.byId("inputTotalJor").setValue(e.toFixed(2));var l=parseFloat(this.byId("inputServi1").getValue())||0;var c=parseFloat(this.byId("inputOtrosServi1").getValue())||0;var d=parseFloat(this.byId("inputGastoVia1").getValue())||0;t=l+c+d;this.byId("totalRecuInter").setValue(t.toFixed(2));var u=parseFloat(this.byId("inputServi2").getValue())||0;var h=parseFloat(this.byId("inputOtroSer2").getValue())||0;var g=parseFloat(this.byId("inptGastoVi2").getValue())||0;a=u+h+g;this.byId("totalConsuExternot").setValue(a.toFixed(2));var x=parseFloat(this.byId("inputServi").getValue())||0;var p=parseFloat(this.byId("input10_1724757017406").getValue())||0;var f=parseFloat(this.byId("input9_1724757015442").getValue())||0;o=x+p+f;this.byId("totaRecurExterno").setValue(o.toFixed(2));var y=parseFloat(this.byId("totalInfraestruc").getValue())||0;var T=parseFloat(this.byId("input0_1724758359").getValue())||0;s=t+a+o+y+T;this.byId("totalSubtotal").setValue(s.toFixed(2));var m=parseFloat(this.byId("input2_172475612").getValue())||0;var I=s*m;this.byId("input2_1724756105").setValue(I.toFixed(2));var v=parseFloat(this.byId("input2_17221205").getValue());var b=s+I;console.log("TOTAL SUMAMAR : "+b);var F=b/v;console.log("TOTAL2  : "+F);var C=F-b;this.byId("input2_1756121205").setValue(C.toFixed(2));var w=s+I+C;this.byId("input0_1725625161348").setValue(w.toFixed(2))},findTotalColumnIndex:function(e){var t=e.getColumns();var a=t.length-1;for(var o=0;o<t.length;o++){var s=t[o].getHeader();if(s&&(s.getText()==="Total1"||s.getText()==="")){return o}}console.warn("Advertencia: No se encontró la columna 'Total1'. Se usará la última columna.");return a+1},getMonthsDifference:function(e,t){var a=(t.getFullYear()-e.getFullYear())*12;a-=e.getMonth();a+=t.getMonth();return a<0?0:a},onNavToView1:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("appNoparame")},onSelectOpx:function(e){var t=this.byId("slct_inic").getSelectedItem();var a=this.byId("idNatu");var o=t.getText();console.log("Valor seleccionado:",o);var s=this.getView().byId("table0");if(o==="Opex Servicios"){s.setVisible(true);this.byId("input2_172475612").setValue(parseFloat("0.00%".replace("%","")).toFixed(2));this.byId("text67_1728582763477").setText("Opex Servicios  - El Margen debe ser establecido al 0%")}else{s.setVisible(false);this.byId("input2_172475612").setValue(parseFloat("5.00%".replace("%","")).toFixed(2))}if(o==="Proyecto/Servicio a Cliente Externo"){this.byId("input2_17221205").setValue(parseFloat("20.00".replace(",",".")).toFixed(2));this.byId("text67_1728582763477").setText("Margen por defecto 20%, si es inferior al 14,29% la propuesta debe pasar por comité")}else if(o==="Proyecto/Servicio Interno PdV"){this.byId("input2_17221205").setValue(parseFloat("10.00".replace(",",".")).toFixed(2));this.byId("text67_1728582763477").setText("Margen por defecto 10%, si el Margen es inferior al 5% la propuesta debe pasar por comité")}else if(o==="Proyecto/Servicio de Inversion"){this.byId("input2_17221205").setValue(parseFloat("0.00".replace(",",".")).toFixed(2));this.byId("text67_1728582763477").setText("Proyecto/Servicio de Inversión - El Margen debe ser establecido al 0%")}else{this.byId("input2_17221205").setValue("")}},onCheckBoxSelectMulti:function(e){console.log("onCheckBoxSelect called");var t=e.getSource();var a=t.getSelected();console.log("Checkbox selected: ",a);var o=this.byId("table_clienteFac");console.log("Table found: ",!!o);if(o){o.setVisible(a)}},onInputChange:function(){var e=this.getView();var t=this.byId("input0").getValue();var a=this.byId("input1").getValue();var o=this.byId("id_Cfactur").getValue();var s=this.byId("int_clienteFun").getValue();var r=this.byId("slct_area");var n="";var i="";if(r&&r.getSelectedItem()){n=r.getSelectedItem().getText();i=r.getSelectedItem().getKey()}var l=this.byId("slct_Jefe");var c="";if(l&&l.getSelectedItem()){c=l.getSelectedItem().getText()}var d=this.byId("slct_client");var u="";if(d&&d.getSelectedItem()){u=d.getSelectedItem().getText()}var h=this.byId("date_inico");var g=h?h.getDateValue():null;var x="";if(g){x=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"}).format(g)}var p=this.byId("slct_inic");var f="";if(p&&p.getSelectedItem()){f=p.getSelectedItem().getText()}var y=this.byId("idNatu");var T="";if(y&&y.getSelectedItem()){T=y.getSelectedItem().getText()}var m=this.byId("date_fin");var I=m?m.getDateValue():null;var v="";if(I){v=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"}).format(I)}this.byId("txt_codig").setText(t);this.byId("txt_nomPro").setText(a);this.byId("txt_area").setText(n);this.byId("txt_NomJefe").setText(c);this.byId("txt_funcio").setText(s);this.byId("txt_feIni").setText(x);this.byId("txt_feFin").setText(v);this.byId("txt_ini").setText(f);this.byId("text72_1731325324246").setText(f);this.byId("text73_1731325328049").setText(T);this.byId("txt_client").setText(s);this.byId("txt_cFactura").setText(o);this.byId("txt_Codi2").setText(t);this.byId("txt_Nombre2").setText(a);this.byId("txt_area2").setText(n);this.byId("txt_Fe_ini2").setText(x);this.byId("txt_Fe_fin2").setText(v);this.byId("textClitFu3").setText(s);this.byId("textCliFac3").setText(o);this.byId("textCodigo3").setText(t);this.byId("textNatural3").setText(T);this.byId("txtNombre3").setText(a);this.byId("txtAre3").setText(n);this.byId("txtFechInici3").setText(x);this.byId("txtFechFin3").setText(v)},onSelectCheckbox:function(e){try{var t=this.byId("table2");if(!t){console.error("Tabla no encontrada.");return}var a=t.getItems();var o=e.getSource().getSelected();if(o===undefined){console.error("Error al obtener el estado del checkbox.");return}var s=e.getSource().getParent().getParent().indexOfColumn(e.getSource().getParent());var r=s===0?"box_prove":"box_condi";var n=this.byId(r);if(!n){console.error("El otro checkbox no se encontró.");return}n.setEnabled(!o);a.forEach(function(e){var t=e.getCells();t.forEach(function(e,t){if(e.setEditable){e.setEditable(t===s?o:!o)}})})}catch(e){console.error("Error en la función onSelectCheckbox:",e)}}})});
//# sourceMappingURL=View1.controller.js.map